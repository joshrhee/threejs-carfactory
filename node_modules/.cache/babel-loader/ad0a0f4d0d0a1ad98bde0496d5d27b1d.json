{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGL1Renderer, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React, { createContext, useState, useRef, useCallback, useMemo, useLayoutEffect, useEffect, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\nvar name = \"react-three-fiber\";\nvar version = \"5.1.5\";\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\n\nconst addEffect = callback => createSubs(callback, globalEffects);\n\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\n\nconst addTail = callback => createSubs(callback, globalTailEffects);\n\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  let i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  const delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\n\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0;\n  let i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) {\n    roots.forEach(root => root.containerInfo.__state.current.frames = frames);\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nfunction forceResize() {\n  roots.forEach(root => root.containerInfo.__state.current.forceResize());\n}\n\nlet catalogue = {};\n\nconst extend = objects => void (catalogue = { ...catalogue,\n  ...objects\n});\n\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = [];\n  const handlers = [];\n  let i;\n  let keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  const leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  const toFilter = [...sameProps, 'children', 'key', 'ref']; // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n  const filteredProps = { ...newProps\n  }; // Removes sameProps and reserved props from newProps\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  const filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        const isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            target.set(...value);\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n              target.copy(value);\n            } // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, {\n  args = [],\n  ...props\n}, container, hostContext, internalInstanceHandle) {\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = {\n      dispose: null,\n      ...props\n    };\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    const target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/react-spring/react-three-fiber/blob/master/api.md#putting-already-existing-objects-into-the-scene-graph\";\n    }\n\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = {\n      attach: 'geometry',\n      ...props\n    };\n  } else if (name.endsWith('Material')) {\n    props = {\n      attach: 'material',\n      ...props\n    };\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove interactivity\n        if (child.__container) {\n          child.__container.__interaction = child.__container.__interaction.filter(x => x !== child);\n        } // Remove nested child objects\n\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = [],\n        ...restNew\n      } = newProps;\n      const {\n        args: argsOld = [],\n        ...restOld\n      } = oldProps; // If it has new props or arguments, then it needs to be re-instanciated\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {\n    return null;\n  },\n\n  preparePortalMount() {\n    return null;\n  },\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  },\n\n  clearContainer() {\n    return false;\n  }\n\n});\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    let newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container, callback) {\n  const root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, () => {\n      roots.delete(container);\n      if (callback) callback(container);\n    });\n  }\n}\n\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: () => null,\n  version: version,\n  rendererPackageName: name\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = /*#__PURE__*/createContext({});\n\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    colorManagement = true,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed,\n    forceResize\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const {\n        filter,\n        computeOffsets,\n        ...raycasterProps\n      } = raycaster;\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        var _state$current;\n\n        if ((_state$current = state.current) == null ? void 0 : _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n        }\n      };\n    },\n    setDefaultCamera: camera => setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: (event = {}, prepare = true) => handlePointerMove(event, prepare),\n    forceResize\n  });\n  const getCurrentViewport = useCallback((camera = state.current.camera, target = new Vector3(0, 0, 0)) => {\n    const {\n      width,\n      height\n    } = state.current.size;\n    const distance = camera.position.distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance\n      };\n    } else {\n      const fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, gl, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  const hovered = useMemo(() => new Map(), []);\n  const temp = new Vector3();\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    const offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event)) || event.nativeEvent;\n\n    if (offsets) {\n      const {\n        offsetX,\n        offsetY\n      } = offsets;\n      const {\n        width,\n        height\n      } = state.current.size;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (const intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push({ ...intersect,\n          eventObject\n        });\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    const dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    const dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const handlePointerCancel = useCallback((event, hits, prepare = true) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event); // commenting this out as I believe it is unneccessary and causes a recursive dependency\n    // if (!hits) hits = handleIntersects(event, () => null)\n\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n        hovered.delete(makeId(data));\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut({ ...data,\n            type: 'pointerout'\n          });\n          if (handlers.pointerLeave) handlers.pointerLeave({ ...data,\n            type: 'pointerleave'\n          });\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  const getIntersects = useCallback((event, filter) => {\n    // Get fresh intersects\n    const intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!intersections.find(hit => hit.eventObject === captured.eventObject)) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((intersections, event, fn) => {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (const hit of intersections) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) {\n            state.current.captured.push(hit);\n          } // Call the original event now\n\n\n          event.target.setPointerCapture(id);\n        };\n\n        const raycastEvent = { ...event,\n          ...hit,\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/react-spring/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const cap = state.current.captured;\n\n            if (!cap || cap.find(h => h.eventObject.id === hit.eventObject.id)) {\n              raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n\n              if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) handlePointerCancel(raycastEvent, [hit]);\n            }\n          },\n          target: { ...event.target,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          currentTarget: { ...event.currentTarget,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          sourceEvent: event\n        };\n        fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n        if (localState.stopped === true) break;\n      }\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  const handlePointerMove = useCallback((event, prepare = true) => {\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver({ ...data,\n            type: 'pointerover'\n          });\n          if (handlers.pointerEnter) handlers.pointerEnter({ ...data,\n            type: 'pointerenter'\n          });\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const handlePointer = useCallback(name => (event, prepare = true) => {\n    state.current.pointer.emit(name, event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click events,\n        // which must use the initial target\n        if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n          handlers[name](data);\n        }\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const {\n      ready,\n      manual,\n      vr,\n      noEvents,\n      invalidateFrameloop,\n      frames,\n      subscribers,\n      captured,\n      initialClick,\n      initialHits,\n      ...props\n    } = state.current;\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, colorManagement]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/React.createElement(Canvas, null, /*#__PURE__*/React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      state.current.gl.renderLists.dispose();\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      dispose(state.current.gl);\n    }\n\n    unmountComponentAtNode(state.current.scene, () => {\n      dispose(state.current.raycaster);\n      dispose(state.current.camera);\n      dispose(state.current);\n    });\n  }, []);\n  return state.current.events;\n};\n\nfunction dispose(obj) {\n  if (obj.dispose) obj.dispose();\n\n  for (const p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), []);\n  return ref;\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, url) {\n    // Construct new loader and run extensions\n    const loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise((res, reject) => loader.load(url, data => {\n      if (data.scene) {\n        data.nodes = {};\n        data.materials = {};\n        data.scene.traverse(obj => {\n          if (obj.name) data.nodes[obj.name] = obj;\n          if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n        });\n      }\n\n      res(data);\n    }, onProgress, error => reject(error.message)))));\n  };\n}\n\nfunction useLoader(Proto, url, extensions, onProgress) {\n  // Use suspense to load async assets\n  const results = useAsset(loadingFn(extensions, onProgress), [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, url, extensions) {\n  return useAsset.preload(loadingFn(extensions), Proto, url);\n};\n\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content({\n  children,\n  setEvents,\n  container,\n  renderer,\n  effects,\n  ...props\n}) {\n  // Create renderer\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  useEffect(() => {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas({ ...props,\n    children,\n    gl: gl\n  });\n  useEffect(() => {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nconst ResizeContainer = /*#__PURE__*/React.memo(function ResizeContainer(props) {\n  const {\n    renderer,\n    effects,\n    children,\n    vr,\n    webgl1,\n    concurrent,\n    shadowMap,\n    colorManagement,\n    orthographic,\n    invalidateFrameloop,\n    updateDefaultCamera,\n    noEvents,\n    gl,\n    camera,\n    raycaster,\n    pixelRatio,\n    onCreated,\n    onPointerMissed,\n    preRender,\n    resize,\n    style,\n    ...restSpread\n  } = props;\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [{\n    onGotPointerCaptureLegacy,\n    ...events\n  }, setEvents] = useState({});\n  const [bind, size, forceResize] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    forceResize,\n    setEvents,\n    container: containerRef.current\n  }), [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React.createElement(\"div\", _extends({\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React.createElement(Content, _extends({}, props, state)));\n});\nconst Canvas = /*#__PURE__*/React.memo(function Canvas({\n  children,\n  ...props\n}) {\n  const canvasRef = useRef();\n  const renderer = props.webgl1 ? WebGL1Renderer : WebGLRenderer;\n  return /*#__PURE__*/React.createElement(ResizeContainer, _extends({}, props, {\n    renderer: () => {\n      if (canvasRef.current) {\n        const params = {\n          antialias: true,\n          alpha: true,\n          ...props.gl\n        };\n        const temp = new renderer({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current,\n          ...params\n        });\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\nexport { Canvas, Renderer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, forceResize, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/Users/sangjunerhee/Downloads/Threejs-CarFactory/node_modules/react-three-fiber/web.js"],"names":["_extends","THREE","Layers","Color","Texture","sRGBEncoding","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","Vector3","PCFSoftShadowMap","ACESFilmicToneMapping","WebGL1Renderer","WebGLRenderer","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","React","createContext","useState","useRef","useCallback","useMemo","useLayoutEffect","useEffect","useContext","useContext$1","TinyEmitter","useAsset","useMeasure","ResizeObserver","mergeRefs","name","version","roots","Map","emptyObject","is","obj","a","Object","arr","fun","str","num","und","Array","isArray","equ","b","i","createSubs","callback","subs","index","length","push","splice","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","renderGl","state","timestamp","repeat","runGlobalEffects","delta","current","clock","getDelta","subscribers","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","forEach","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","forceResize","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","handlers","keys","startsWith","includes","leftOvers","toFilter","__instance","filteredProps","indexOf","undefined","filteredPropsEntries","entries","key","value","_instance$__container","_instance$__container2","target","split","reduce","acc","set","reverseEntries","reverse","isColorManagement","colorManagement","copy","constructor","convertSRGBToLinear","encoding","invalidateInstance","raycast","__handlers","__interaction","charAt","toLowerCase","substr","parent","updateInstance","onUpdate","createInstance","type","args","props","hostContext","internalInstanceHandle","toUpperCase","slice","dispose","object","__dispose","has","fn","node","return","stateNode","__objects","endsWith","attach","appendChild","parentInstance","child","isObject3D","add","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","filter","sibling","removeRecursive","array","clone","removeChild","remove","x","switchInstance","fiber","newInstance","alternate","Renderer","now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","hasSymbol","Symbol","for","REACT_PORTAL_TYPE","element","get","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","findHostInstanceByFiber","rendererPackageName","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","useCanvas","orthographic","raycaster","size","pixelRatio","shadowMap","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","defaultRaycaster","ray","computeOffsets","raycasterProps","defaultScene","defaultCam","setDefaultCamera","cam","position","z","lookAt","aspect","viewport","initialClick","initialHits","pointer","captured","events","subscribe","priority","sort","_state$current","s","intersect","prepare","handlePointerMove","getCurrentViewport","width","height","distance","distanceTo","zoom","factor","fov","PI","h","tan","w","assign","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","hovered","temp","prepareRay","offsets","nativeEvent","offsetX","offsetY","setFromCamera","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","sharedState","calculateDistance","dx","dy","round","sqrt","handlePointerCancel","emit","from","values","data","find","pointerOut","pointerLeave","getIntersects","intersections","hit","handleIntersects","unprojectedPoint","y","unproject","releasePointerCapture","localState","stopped","setPointerCapture","raycastEvent","stopPropagation","cap","currentTarget","sourceEvent","pointerOver","pointerEnter","hoveredItem","pointerMove","handlePointer","map","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","setPixelRatio","min","window","devicePixelRatio","enabled","toneMapping","outputEncoding","Canvas","activate","result","then","createElement","Provider","xr","setAnimationLoop","t","console","warn","renderLists","forceContextLoss","p","context","useFrame","renderPriority","unsubscribe","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","loadingFn","extensions","onProgress","Proto","url","loader","urlArray","Promise","all","res","reject","load","nodes","materials","traverse","material","error","message","useLoader","results","preload","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","webgl1","preRender","resize","style","restSpread","containerRef","bind","scroll","debounce","polyfill","readyFlag","canvasRef","params","antialias","alpha","powerPreference","canvas","display"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,oCAArB;AACA,OAAO,KAAKC,KAAZ,MAAuB,OAAvB;AACA,SAASC,MAAT,EAAiBC,KAAjB,EAAwBC,OAAxB,EAAiCC,YAAjC,EAA+CC,OAA/C,EAAwDC,SAAxD,EAAmEC,KAAnE,EAA0EC,kBAA1E,EAA8FC,iBAA9F,EAAiHC,KAAjH,EAAwHC,OAAxH,EAAiIC,gBAAjI,EAAmJC,qBAAnJ,EAA0KC,cAA1K,EAA0LC,aAA1L,QAA+M,OAA/M;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,SAASC,YAAT,EAAuBC,wBAAvB,EAAiDC,qBAAjD,QAA8E,WAA9E;AACA,OAAOC,KAAP,IAAgBC,aAAhB,EAA+BC,QAA/B,EAAyCC,MAAzC,EAAiDC,WAAjD,EAA8DC,OAA9D,EAAuEC,eAAvE,EAAwFC,SAAxF,EAAmGC,UAAU,IAAIC,YAAjH,QAAqI,OAArI;AACA,SAASC,WAAT,QAA4B,cAA5B;AACA,SAASC,QAAT,QAAyB,WAAzB;AACA,OAAOC,UAAP,MAAuB,mBAAvB;AACA,SAASC,cAAT,QAA+B,yBAA/B;AACA,OAAOC,SAAP,MAAsB,kBAAtB;AAEA,IAAIC,IAAI,GAAG,mBAAX;AACA,IAAIC,OAAO,GAAG,OAAd;AAEA,MAAMC,KAAK,GAAG,IAAIC,GAAJ,EAAd;AACA,MAAMC,WAAW,GAAG,EAApB;AACA,MAAMC,EAAE,GAAG;AACTC,EAAAA,GAAG,EAAEC,CAAC,IAAIA,CAAC,KAAKC,MAAM,CAACD,CAAD,CAAZ,IAAmB,CAACF,EAAE,CAACI,GAAH,CAAOF,CAAP,CADrB;AAETG,EAAAA,GAAG,EAAEH,CAAC,IAAI,OAAOA,CAAP,KAAa,UAFd;AAGTI,EAAAA,GAAG,EAAEJ,CAAC,IAAI,OAAOA,CAAP,KAAa,QAHd;AAITK,EAAAA,GAAG,EAAEL,CAAC,IAAI,OAAOA,CAAP,KAAa,QAJd;AAKTM,EAAAA,GAAG,EAAEN,CAAC,IAAIA,CAAC,KAAK,KAAK,CALZ;AAMTE,EAAAA,GAAG,EAAEF,CAAC,IAAIO,KAAK,CAACC,OAAN,CAAcR,CAAd,CAND;;AAQTS,EAAAA,GAAG,CAACT,CAAD,EAAIU,CAAJ,EAAO;AACR;AACA,QAAI,OAAOV,CAAP,KAAa,OAAOU,CAApB,IAAyB,CAAC,CAACV,CAAF,KAAQ,CAAC,CAACU,CAAvC,EAA0C,OAAO,KAAP,CAFlC,CAEgD;;AAExD,QAAIZ,EAAE,CAACM,GAAH,CAAOJ,CAAP,KAAaF,EAAE,CAACO,GAAH,CAAOL,CAAP,CAAb,IAA0BF,EAAE,CAACC,GAAH,CAAOC,CAAP,CAA9B,EAAyC,OAAOA,CAAC,KAAKU,CAAb,CAJjC,CAIiD;;AAEzD,QAAIZ,EAAE,CAACI,GAAH,CAAOF,CAAP,KAAaA,CAAC,IAAIU,CAAtB,EAAyB,OAAO,IAAP,CANjB,CAM8B;;AAEtC,QAAIC,CAAJ;;AAEA,SAAKA,CAAL,IAAUX,CAAV,EAAa,IAAI,EAAEW,CAAC,IAAID,CAAP,CAAJ,EAAe,OAAO,KAAP;;AAE5B,SAAKC,CAAL,IAAUD,CAAV,EAAa,IAAIV,CAAC,CAACW,CAAD,CAAD,KAASD,CAAC,CAACC,CAAD,CAAd,EAAmB,OAAO,KAAP;;AAEhC,WAAOb,EAAE,CAACQ,GAAH,CAAOK,CAAP,IAAYX,CAAC,KAAKU,CAAlB,GAAsB,IAA7B;AACD;;AAvBQ,CAAX;;AA2BA,SAASE,UAAT,CAAoBC,QAApB,EAA8BC,IAA9B,EAAoC;AAClC,QAAMC,KAAK,GAAGD,IAAI,CAACE,MAAnB;AACAF,EAAAA,IAAI,CAACG,IAAL,CAAUJ,QAAV;AACA,SAAO,MAAM,KAAKC,IAAI,CAACI,MAAL,CAAYH,KAAZ,EAAmB,CAAnB,CAAlB;AACD;;AAED,IAAII,aAAa,GAAG,EAApB;AACA,IAAIC,kBAAkB,GAAG,EAAzB;AACA,IAAIC,iBAAiB,GAAG,EAAxB;;AACA,MAAMC,SAAS,GAAGT,QAAQ,IAAID,UAAU,CAACC,QAAD,EAAWM,aAAX,CAAxC;;AACA,MAAMI,cAAc,GAAGV,QAAQ,IAAID,UAAU,CAACC,QAAD,EAAWO,kBAAX,CAA7C;;AACA,MAAMI,OAAO,GAAGX,QAAQ,IAAID,UAAU,CAACC,QAAD,EAAWQ,iBAAX,CAAtC;;AACA,SAASI,QAAT,CAAkBC,KAAlB,EAAyBC,SAAzB,EAAoCC,MAAM,GAAG,CAA7C,EAAgDC,gBAAgB,GAAG,KAAnE,EAA0E;AACxE,MAAIlB,CAAJ,CADwE,CACjE;;AAEP,MAAIkB,gBAAJ,EAAsB;AACpB,SAAKlB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGQ,aAAa,CAACH,MAA9B,EAAsCL,CAAC,EAAvC,EAA2C;AACzCQ,MAAAA,aAAa,CAACR,CAAD,CAAb,CAAiBgB,SAAjB;AACAC,MAAAA,MAAM;AACP;AACF,GARuE,CAQtE;;;AAGF,QAAME,KAAK,GAAGJ,KAAK,CAACK,OAAN,CAAcC,KAAd,CAAoBC,QAApB,EAAd;;AAEA,OAAKtB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGe,KAAK,CAACK,OAAN,CAAcG,WAAd,CAA0BlB,MAA1C,EAAkDL,CAAC,EAAnD,EAAuD;AACrDe,IAAAA,KAAK,CAACK,OAAN,CAAcG,WAAd,CAA0BvB,CAA1B,EAA6BwB,GAA7B,CAAiCJ,OAAjC,CAAyCL,KAAK,CAACK,OAA/C,EAAwDD,KAAxD;AACD,GAfuE,CAetE;;;AAGFJ,EAAAA,KAAK,CAACK,OAAN,CAAcK,MAAd,GAAuBC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYZ,KAAK,CAACK,OAAN,CAAcK,MAAd,GAAuB,CAAnC,CAAvB;AACAR,EAAAA,MAAM,IAAI,CAACF,KAAK,CAACK,OAAN,CAAcQ,mBAAf,GAAqC,CAArC,GAAyCb,KAAK,CAACK,OAAN,CAAcK,MAAjE,CAnBwE,CAmBC;;AAEzE,MAAI,CAACV,KAAK,CAACK,OAAN,CAAcS,MAAf,IAAyBd,KAAK,CAACK,OAAN,CAAcU,EAAd,CAAiBC,MAA9C,EAAsDhB,KAAK,CAACK,OAAN,CAAcU,EAAd,CAAiBC,MAAjB,CAAwBhB,KAAK,CAACK,OAAN,CAAcY,KAAtC,EAA6CjB,KAAK,CAACK,OAAN,CAAca,MAA3D,EArBkB,CAqBkD;;AAE1H,MAAIf,gBAAJ,EAAsB;AACpB,SAAKlB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGS,kBAAkB,CAACJ,MAAnC,EAA2CL,CAAC,EAA5C,EAAgD;AAC9CS,MAAAA,kBAAkB,CAACT,CAAD,CAAlB,CAAsBgB,SAAtB;AACD;AACF;;AAED,SAAOC,MAAP;AACD;;AACD,IAAIiB,OAAO,GAAG,KAAd;;AAEA,SAASC,UAAT,CAAoBnB,SAApB,EAA+B;AAC7BkB,EAAAA,OAAO,GAAG,IAAV;AACA,MAAIjB,MAAM,GAAG,CAAb;AACA,MAAIjB,CAAJ,CAH6B,CAGtB;;AAEP,OAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGQ,aAAa,CAACH,MAA9B,EAAsCL,CAAC,EAAvC,EAA2C;AACzCQ,IAAAA,aAAa,CAACR,CAAD,CAAb,CAAiBgB,SAAjB;AACAC,IAAAA,MAAM;AACP;;AAEDjC,EAAAA,KAAK,CAACoD,OAAN,CAAcC,IAAI,IAAI;AACpB,UAAMtB,KAAK,GAAGsB,IAAI,CAACC,aAAL,CAAmBC,OAAjC,CADoB,CACsB;;AAE1C,QAAIxB,KAAK,CAACK,OAAN,CAAcoB,MAAd,IAAwBzB,KAAK,CAACK,OAAN,CAAcqB,KAAtC,KAAgD,CAAC1B,KAAK,CAACK,OAAN,CAAcQ,mBAAf,IAAsCb,KAAK,CAACK,OAAN,CAAcK,MAAd,GAAuB,CAA7G,CAAJ,EAAqH;AACnHR,MAAAA,MAAM,GAAGH,QAAQ,CAACC,KAAD,EAAQC,SAAR,EAAmBC,MAAnB,CAAjB;AACD;AACF,GAND,EAV6B,CAgBzB;;AAEJ,OAAKjB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGS,kBAAkB,CAACJ,MAAnC,EAA2CL,CAAC,EAA5C,EAAgD;AAC9CS,IAAAA,kBAAkB,CAACT,CAAD,CAAlB,CAAsBgB,SAAtB;AACD;;AAED,MAAIC,MAAM,KAAK,CAAf,EAAkB;AAChB,WAAOyB,qBAAqB,CAACP,UAAD,CAA5B;AACD,GAFD,MAEO;AACL;AACA,SAAKnC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGU,iBAAiB,CAACL,MAAlC,EAA0CL,CAAC,EAA3C,EAA+C;AAC7CU,MAAAA,iBAAiB,CAACV,CAAD,CAAjB,CAAqBgB,SAArB;AACD;AACF,GA7B4B,CA6B3B;;;AAGFkB,EAAAA,OAAO,GAAG,KAAV;AACD;;AAED,SAASS,UAAT,CAAoB5B,KAAK,GAAG,IAA5B,EAAkCU,MAAM,GAAG,CAA3C,EAA8C;AAC5C,MAAIV,KAAK,KAAK,IAAd,EAAoB;AAClB/B,IAAAA,KAAK,CAACoD,OAAN,CAAcC,IAAI,IAAIA,IAAI,CAACC,aAAL,CAAmBC,OAAnB,CAA2BnB,OAA3B,CAAmCK,MAAnC,GAA4CA,MAAlE;AACD,GAFD,MAEO,IAAIV,KAAK,IAAIA,KAAK,CAACK,OAAnB,EAA4B;AACjC,QAAIL,KAAK,CAACK,OAAN,CAAcwB,EAAlB,EAAsB;AACtB7B,IAAAA,KAAK,CAACK,OAAN,CAAcK,MAAd,GAAuBA,MAAvB;AACD;;AAED,MAAI,CAACS,OAAL,EAAc;AACZA,IAAAA,OAAO,GAAG,IAAV;AACAQ,IAAAA,qBAAqB,CAACP,UAAD,CAArB;AACD;AACF;;AACD,SAASU,WAAT,GAAuB;AACrB7D,EAAAA,KAAK,CAACoD,OAAN,CAAcC,IAAI,IAAIA,IAAI,CAACC,aAAL,CAAmBC,OAAnB,CAA2BnB,OAA3B,CAAmCyB,WAAnC,EAAtB;AACD;;AACD,IAAIC,SAAS,GAAG,EAAhB;;AACA,MAAMC,MAAM,GAAGC,OAAO,IAAI,MAAMF,SAAS,GAAG,EAAE,GAAGA,SAAL;AAC1C,KAAGE;AADuC,CAAlB,CAA1B;;AAGA,SAASC,UAAT,CAAoBC,QAApB,EAA8BC,QAA9B,EAAwCC,QAAQ,GAAG,EAAnD,EAAuDC,YAAY,GAAG,KAAtE,EAA6E;AAC3E;AACA,QAAMC,SAAS,GAAGJ,QAAQ,CAACK,WAA3B;AACA,QAAMC,SAAS,GAAG,EAAlB;AACA,QAAMC,QAAQ,GAAG,EAAjB;AACA,MAAIzD,CAAJ;AACA,MAAI0D,IAAI,GAAGpE,MAAM,CAACoE,IAAP,CAAYP,QAAZ,CAAX;;AAEA,OAAKnD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0D,IAAI,CAACrD,MAArB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,QAAIb,EAAE,CAACW,GAAH,CAAOqD,QAAQ,CAACO,IAAI,CAAC1D,CAAD,CAAL,CAAf,EAA0BoD,QAAQ,CAACM,IAAI,CAAC1D,CAAD,CAAL,CAAlC,CAAJ,EAAkD;AAChDwD,MAAAA,SAAS,CAAClD,IAAV,CAAeoD,IAAI,CAAC1D,CAAD,CAAnB;AACD,KAH+B,CAG9B;AACF;AACA;AACA;;;AAGA,QAAIb,EAAE,CAACK,GAAH,CAAO2D,QAAQ,CAACO,IAAI,CAAC1D,CAAD,CAAL,CAAf,KAA6B0D,IAAI,CAAC1D,CAAD,CAAJ,CAAQ2D,UAAR,CAAmB,IAAnB,CAAjC,EAA2D;AACzD,UAAID,IAAI,CAAC1D,CAAD,CAAJ,CAAQ4D,QAAR,CAAiB,SAAjB,KAA+BF,IAAI,CAAC1D,CAAD,CAAJ,CAAQ4D,QAAR,CAAiB,OAAjB,CAA/B,IAA4DF,IAAI,CAAC1D,CAAD,CAAJ,CAAQ4D,QAAR,CAAiB,aAAjB,CAA5D,IAA+FF,IAAI,CAAC1D,CAAD,CAAJ,CAAQ4D,QAAR,CAAiB,OAAjB,CAAnG,EAA8H;AAC5HH,QAAAA,QAAQ,CAACnD,IAAT,CAAcoD,IAAI,CAAC1D,CAAD,CAAlB;AACD;AACF;AACF;;AAED,QAAM6D,SAAS,GAAG,EAAlB;AACAH,EAAAA,IAAI,GAAGpE,MAAM,CAACoE,IAAP,CAAYN,QAAZ,CAAP;;AAEA,MAAIC,YAAJ,EAAkB;AAChB,SAAKrD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0D,IAAI,CAACrD,MAArB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,UAAImD,QAAQ,CAACO,IAAI,CAAC1D,CAAD,CAAL,CAAR,KAAsB,KAAK,CAA/B,EAAkC;AAChC6D,QAAAA,SAAS,CAACvD,IAAV,CAAeoD,IAAI,CAAC1D,CAAD,CAAnB;AACD;AACF;AACF;;AAED,QAAM8D,QAAQ,GAAG,CAAC,GAAGN,SAAJ,EAAe,UAAf,EAA2B,KAA3B,EAAkC,KAAlC,CAAjB,CAnC2E,CAmChB;;AAE3D,MAAIN,QAAQ,CAACa,UAAb,EAAyBD,QAAQ,CAACxD,IAAT,CAAc,QAAd;AACzB,QAAM0D,aAAa,GAAG,EAAE,GAAGb;AAAL,GAAtB,CAtC2E,CAuCxE;;AAEHO,EAAAA,IAAI,GAAGpE,MAAM,CAACoE,IAAP,CAAYM,aAAZ,CAAP;;AAEA,OAAKhE,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0D,IAAI,CAACrD,MAArB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,QAAI8D,QAAQ,CAACG,OAAT,CAAiBP,IAAI,CAAC1D,CAAD,CAArB,IAA4B,CAAC,CAAjC,EAAoC;AAClC,aAAOgE,aAAa,CAACN,IAAI,CAAC1D,CAAD,CAAL,CAApB;AACD;AACF,GA/C0E,CA+CzE;;;AAGF0D,EAAAA,IAAI,GAAGpE,MAAM,CAACoE,IAAP,CAAYG,SAAZ,CAAP;;AAEA,OAAK7D,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG0D,IAAI,CAACrD,MAArB,EAA6BL,CAAC,EAA9B,EAAkC;AAChC,QAAI0D,IAAI,CAAC1D,CAAD,CAAJ,KAAY,UAAhB,EAA4B;AAC1BgE,MAAAA,aAAa,CAACN,IAAI,CAAC1D,CAAD,CAAL,CAAb,GAAyBkE,SAAzB;AACD;AACF;;AAED,QAAMC,oBAAoB,GAAG7E,MAAM,CAAC8E,OAAP,CAAeJ,aAAf,CAA7B;;AAEA,MAAIG,oBAAoB,CAAC9D,MAArB,GAA8B,CAAlC,EAAqC;AACnC8D,IAAAA,oBAAoB,CAAC/B,OAArB,CAA6B,CAAC,CAACiC,GAAD,EAAMC,KAAN,CAAD,KAAkB;AAC7C,UAAI,CAACb,QAAQ,CAACG,QAAT,CAAkBS,GAAlB,CAAL,EAA6B;AAC3B,YAAIE,qBAAJ,EAA2BC,sBAA3B;;AAEA,YAAInC,IAAI,GAAGa,QAAX;AACA,YAAIuB,MAAM,GAAGpC,IAAI,CAACgC,GAAD,CAAjB;;AAEA,YAAIA,GAAG,CAACT,QAAJ,CAAa,GAAb,CAAJ,EAAuB;AACrB,gBAAMQ,OAAO,GAAGC,GAAG,CAACK,KAAJ,CAAU,GAAV,CAAhB;AACAD,UAAAA,MAAM,GAAGL,OAAO,CAACO,MAAR,CAAe,CAACC,GAAD,EAAMP,GAAN,KAAcO,GAAG,CAACP,GAAD,CAAhC,EAAuCnB,QAAvC,CAAT,CAFqB,CAEsC;;AAE3D,cAAI,EAAEuB,MAAM,IAAIA,MAAM,CAACI,GAAnB,CAAJ,EAA6B;AAC3B,kBAAM,CAAC/F,IAAD,EAAO,GAAGgG,cAAV,IAA4BV,OAAO,CAACW,OAAR,EAAlC;AACA1C,YAAAA,IAAI,GAAGyC,cAAc,CAACC,OAAf,GAAyBJ,MAAzB,CAAgC,CAACC,GAAD,EAAMP,GAAN,KAAcO,GAAG,CAACP,GAAD,CAAjD,EAAwDnB,QAAxD,CAAP;AACAmB,YAAAA,GAAG,GAAGvF,IAAN;AACD;AACF,SAf0B,CAezB;;;AAGF,cAAMkG,iBAAiB,GAAG,CAACT,qBAAqB,GAAGrB,QAAQ,CAACK,WAAlC,KAAkD,IAAlD,GAAyD,KAAK,CAA9D,GAAkE,CAACiB,sBAAsB,GAAGD,qBAAqB,CAAChC,OAAhD,KAA4D,IAA5D,GAAmE,KAAK,CAAxE,GAA4EiC,sBAAsB,CAACpD,OAAvB,CAA+B6D,eAAvM;;AAEA,YAAIR,MAAM,IAAIA,MAAM,CAACI,GAAjB,KAAyBJ,MAAM,CAACS,IAAP,IAAeT,MAAM,YAAY7H,MAA1D,CAAJ,EAAuE;AACrE;AACA,cAAIgD,KAAK,CAACC,OAAN,CAAcyE,KAAd,CAAJ,EAA0B;AACxBG,YAAAA,MAAM,CAACI,GAAP,CAAW,GAAGP,KAAd;AACD,WAFD,CAEE;AAFF,eAGK,IAAIG,MAAM,CAACS,IAAP,IAAeZ,KAAf,IAAwBA,KAAK,CAACa,WAA9B,IAA6CV,MAAM,CAACU,WAAP,CAAmBrG,IAAnB,KAA4BwF,KAAK,CAACa,WAAN,CAAkBrG,IAA/F,EAAqG;AACtG2F,cAAAA,MAAM,CAACS,IAAP,CAAYZ,KAAZ;AACD,aAFE,CAED;AACF;AAHG,iBAIE,IAAIA,KAAK,KAAKJ,SAAd,EAAyB;AAC1BO,gBAAAA,MAAM,CAACI,GAAP,CAAWP,KAAX,EAD0B,CACP;AACnB;;AAEA,oBAAIU,iBAAiB,IAAIP,MAAM,YAAY5H,KAA3C,EAAkD;AAChD4H,kBAAAA,MAAM,CAACW,mBAAP;AACD;AACF,eAhBgE,CAgB/D;;AAEP,SAlBD,MAkBO;AACL/C,UAAAA,IAAI,CAACgC,GAAD,CAAJ,GAAYC,KAAZ,CADK,CACc;AACnB;;AAEA,cAAIU,iBAAiB,IAAI3C,IAAI,CAACgC,GAAD,CAAJ,YAAqBvH,OAA9C,EAAuD;AACrDuF,YAAAA,IAAI,CAACgC,GAAD,CAAJ,CAAUgB,QAAV,GAAqBtI,YAArB;AACD;AACF;;AAEDuI,QAAAA,kBAAkB,CAACpC,QAAD,CAAlB;AACD;AACF,KAlDD,EADmC,CAmD/B;;AAEJ,QAAIG,YAAY,IAAIC,SAAhB,IAA6BJ,QAAQ,CAACqC,OAAtC,IAAiDrC,QAAQ,CAACsC,UAA9D,EAA0E;AACxEtC,MAAAA,QAAQ,CAACsC,UAAT,GAAsBtB,SAAtB;;AAEA,YAAM9D,KAAK,GAAGkD,SAAS,CAACmC,aAAV,CAAwBxB,OAAxB,CAAgCf,QAAhC,CAAd;;AAEA,UAAI9C,KAAK,GAAG,CAAC,CAAb,EAAgBkD,SAAS,CAACmC,aAAV,CAAwBlF,MAAxB,CAA+BH,KAA/B,EAAsC,CAAtC;AACjB,KA3DkC,CA2DjC;;;AAGF,QAAIqD,QAAQ,CAACpD,MAAb,EAAqB;AACnB;AACA,UAAIiD,SAAS,IAAIJ,QAAQ,CAACqC,OAA1B,EAAmCjC,SAAS,CAACmC,aAAV,CAAwBnF,IAAxB,CAA6B4C,QAA7B,EAFhB,CAEwD;;AAE3EA,MAAAA,QAAQ,CAACsC,UAAT,GAAsB/B,QAAQ,CAACkB,MAAT,CAAgB,CAACC,GAAD,EAAMP,GAAN,KAAc;AAClDO,QAAAA,GAAG,CAACP,GAAG,CAACqB,MAAJ,CAAW,CAAX,EAAcC,WAAd,KAA8BtB,GAAG,CAACuB,MAAJ,CAAW,CAAX,CAA/B,CAAH,GAAmDzC,QAAQ,CAACkB,GAAD,CAA3D;AACA,eAAOO,GAAP;AACD,OAHqB,EAGnB,EAHmB,CAAtB;AAID,KAtEkC,CAsEjC;;;AAGF,QAAI1B,QAAQ,CAAC2C,MAAb,EAAqBC,cAAc,CAAC5C,QAAD,CAAd;AACtB;AACF;;AAED,SAASoC,kBAAT,CAA4BpC,QAA5B,EAAsC;AACpC,MAAIA,QAAQ,CAACK,WAAT,IAAwBL,QAAQ,CAACK,WAAT,CAAqBhB,OAAjD,EAA0DI,UAAU,CAACO,QAAQ,CAACK,WAAT,CAAqBhB,OAAtB,CAAV;AAC3D;;AAED,SAASuD,cAAT,CAAwB5C,QAAxB,EAAkC;AAChC,MAAIA,QAAQ,CAAC6C,QAAb,EAAuB7C,QAAQ,CAAC6C,QAAT,CAAkB7C,QAAlB;AACxB;;AAED,SAAS8C,cAAT,CAAwBC,IAAxB,EAA8B;AAC5BC,EAAAA,IAAI,GAAG,EADqB;AAE5B,KAAGC;AAFyB,CAA9B,EAGG7C,SAHH,EAGc8C,WAHd,EAG2BC,sBAH3B,EAGmD;AACjD,MAAIvH,IAAI,GAAG,KAAKmH,IAAI,CAAC,CAAD,CAAJ,CAAQK,WAAR,EAAL,GAA6BL,IAAI,CAACM,KAAL,CAAW,CAAX,CAAxC;AACA,MAAIrD,QAAJ;;AAEA,MAAI+C,IAAI,KAAK,WAAb,EAA0B;AACxB;AACAE,IAAAA,KAAK,GAAG;AACNK,MAAAA,OAAO,EAAE,IADH;AAEN,SAAGL;AAFG,KAAR;AAIAjD,IAAAA,QAAQ,GAAGiD,KAAK,CAACM,MAAjB;AACAvD,IAAAA,QAAQ,CAACa,UAAT,GAAsB,IAAtB;AACAb,IAAAA,QAAQ,CAACwD,SAAT,GAAqBxD,QAAQ,CAACsD,OAA9B;AACD,GATD,MASO;AACL,UAAM/B,MAAM,GAAG3B,SAAS,CAAChE,IAAD,CAAT,IAAmBnC,KAAK,CAACmC,IAAD,CAAvC;;AAEA,QAAI,CAAC2F,MAAL,EAAa;AACX,YAAM,OAAO3F,IAAP,GAAc,qMAApB;AACD;;AAEDoE,IAAAA,QAAQ,GAAG/D,EAAE,CAACI,GAAH,CAAO2G,IAAP,IAAe,IAAIzB,MAAJ,CAAW,GAAGyB,IAAd,CAAf,GAAqC,IAAIzB,MAAJ,CAAWyB,IAAX,CAAhD;AACD,GArBgD,CAqB/C;AACF;;;AAGA,SAAO5C,SAAS,CAACC,WAAjB,EAA8B;AAC5BD,IAAAA,SAAS,GAAGA,SAAS,CAACC,WAAtB;AACD,GA3BgD,CA2B/C;AACF;;;AAGA,MAAI,CAACvE,KAAK,CAAC2H,GAAN,CAAUrD,SAAV,CAAL,EAA2B;AACzB,UAAMsD,EAAE,GAAGC,IAAI,IAAI;AACjB,UAAI,CAACA,IAAI,CAACC,MAAV,EAAkB,OAAOD,IAAI,CAACE,SAAL,IAAkBF,IAAI,CAACE,SAAL,CAAezE,aAAxC,CAAlB,KAA6E,OAAOsE,EAAE,CAACC,IAAI,CAACC,MAAN,CAAT;AAC9E,KAFD;;AAIAxD,IAAAA,SAAS,GAAGsD,EAAE,CAACP,sBAAD,CAAd;AACD,GArCgD,CAqC/C;;;AAGFnD,EAAAA,QAAQ,CAAC8D,SAAT,GAAqB,EAArB;AACA9D,EAAAA,QAAQ,CAACK,WAAT,GAAuBD,SAAvB,CAzCiD,CAyCf;;AAElC,MAAIxE,IAAI,CAACmI,QAAL,CAAc,UAAd,CAAJ,EAA+B;AAC7Bd,IAAAA,KAAK,GAAG;AACNe,MAAAA,MAAM,EAAE,UADF;AAEN,SAAGf;AAFG,KAAR;AAID,GALD,MAKO,IAAIrH,IAAI,CAACmI,QAAL,CAAc,UAAd,CAAJ,EAA+B;AACpCd,IAAAA,KAAK,GAAG;AACNe,MAAAA,MAAM,EAAE,UADF;AAEN,SAAGf;AAFG,KAAR;AAID,GArDgD,CAqD/C;AACF;AACA;;;AAGAlD,EAAAA,UAAU,CAACC,QAAD,EAAWiD,KAAX,EAAkB,EAAlB,CAAV;AACA,SAAOjD,QAAP;AACD;;AAED,SAASiE,WAAT,CAAqBC,cAArB,EAAqCC,KAArC,EAA4C;AAC1C,MAAIA,KAAJ,EAAW;AACT,QAAIA,KAAK,CAACC,UAAV,EAAsB;AACpBF,MAAAA,cAAc,CAACG,GAAf,CAAmBF,KAAnB;AACD,KAFD,MAEO;AACLD,MAAAA,cAAc,CAACJ,SAAf,CAAyB1G,IAAzB,CAA8B+G,KAA9B;;AAEAA,MAAAA,KAAK,CAACxB,MAAN,GAAeuB,cAAf,CAHK,CAG0B;;AAE/B,UAAIC,KAAK,CAACG,WAAV,EAAuB;AACrB,YAAI,CAACrI,EAAE,CAACI,GAAH,CAAO6H,cAAc,CAACC,KAAK,CAACG,WAAP,CAArB,CAAL,EAAgDJ,cAAc,CAACC,KAAK,CAACG,WAAP,CAAd,GAAoC,EAApC;AAChDJ,QAAAA,cAAc,CAACC,KAAK,CAACG,WAAP,CAAd,CAAkClH,IAAlC,CAAuC+G,KAAvC;AACD,OAHD,MAGO,IAAIA,KAAK,CAACI,YAAV,EAAwB;AAC7B,YAAI,CAACtI,EAAE,CAACC,GAAH,CAAOgI,cAAc,CAACC,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAD,CAArB,CAAL,EAAoDL,cAAc,CAACC,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAD,CAAd,GAAwC,EAAxC;AACpDL,QAAAA,cAAc,CAACC,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAD,CAAd,CAAsCJ,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAtC,IAA+DJ,KAA/D;AACD,OAHM,MAGA,IAAIA,KAAK,CAACH,MAAV,EAAkB;AACvBE,QAAAA,cAAc,CAACC,KAAK,CAACH,MAAP,CAAd,GAA+BG,KAA/B;AACD;AACF;;AAEDvB,IAAAA,cAAc,CAACuB,KAAD,CAAd;AACA/B,IAAAA,kBAAkB,CAAC+B,KAAD,CAAlB;AACD;AACF;;AAED,SAASK,YAAT,CAAsBN,cAAtB,EAAsCC,KAAtC,EAA6CM,WAA7C,EAA0D;AACxD,MAAIN,KAAJ,EAAW;AACT,QAAIA,KAAK,CAACC,UAAV,EAAsB;AACpBD,MAAAA,KAAK,CAACxB,MAAN,GAAeuB,cAAf;AACAC,MAAAA,KAAK,CAACO,aAAN,CAAoB;AAClB3B,QAAAA,IAAI,EAAE;AADY,OAApB;AAGA,YAAM4B,YAAY,GAAGT,cAAc,CAACU,QAAf,CAAwBC,MAAxB,CAA+BC,OAAO,IAAIA,OAAO,KAAKX,KAAtD,CAArB,CALoB,CAK+D;;AAEnF,YAAMjH,KAAK,GAAGyH,YAAY,CAAC5D,OAAb,CAAqB0D,WAArB,CAAd;AACAP,MAAAA,cAAc,CAACU,QAAf,GAA0B,CAAC,GAAGD,YAAY,CAACtB,KAAb,CAAmB,CAAnB,EAAsBnG,KAAtB,CAAJ,EAAkCiH,KAAlC,EAAyC,GAAGQ,YAAY,CAACtB,KAAb,CAAmBnG,KAAnB,CAA5C,CAA1B;AACA0F,MAAAA,cAAc,CAACuB,KAAD,CAAd;AACD,KAVD,MAUO;AACLF,MAAAA,WAAW,CAACC,cAAD,EAAiBC,KAAjB,CAAX;AACD,KAbQ,CAaP;;;AAGF/B,IAAAA,kBAAkB,CAAC+B,KAAD,CAAlB;AACD;AACF;;AAED,SAASY,eAAT,CAAyBC,KAAzB,EAAgCrC,MAAhC,EAAwCsC,KAAK,GAAG,KAAhD,EAAuD;AACrD,MAAID,KAAJ,EAAW;AACT;AACA,UAAMzD,MAAM,GAAG0D,KAAK,GAAG,CAAC,GAAGD,KAAJ,CAAH,GAAgBA,KAApC;AACAzD,IAAAA,MAAM,CAACrC,OAAP,CAAeiF,KAAK,IAAIe,WAAW,CAACvC,MAAD,EAASwB,KAAT,CAAnC;AACD;AACF;;AAED,SAASe,WAAT,CAAqBhB,cAArB,EAAqCC,KAArC,EAA4C;AAC1C,MAAIA,KAAJ,EAAW;AACT,QAAIA,KAAK,CAACC,UAAV,EAAsB;AACpBF,MAAAA,cAAc,CAACiB,MAAf,CAAsBhB,KAAtB;AACD,KAFD,MAEO;AACLA,MAAAA,KAAK,CAACxB,MAAN,GAAe,IAAf;AACA,UAAIuB,cAAc,CAACJ,SAAnB,EAA8BI,cAAc,CAACJ,SAAf,GAA2BI,cAAc,CAACJ,SAAf,CAAyBe,MAAzB,CAAgCO,CAAC,IAAIA,CAAC,KAAKjB,KAA3C,CAA3B,CAFzB,CAEuG;;AAE5G,UAAIA,KAAK,CAACG,WAAV,EAAuB;AACrBJ,QAAAA,cAAc,CAACC,KAAK,CAACG,WAAP,CAAd,GAAoCJ,cAAc,CAACC,KAAK,CAACG,WAAP,CAAd,CAAkCO,MAAlC,CAAyCO,CAAC,IAAIA,CAAC,KAAKjB,KAApD,CAApC;AACD,OAFD,MAEO,IAAIA,KAAK,CAACI,YAAV,EAAwB;AAC7B,eAAOL,cAAc,CAACC,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAD,CAAd,CAAsCJ,KAAK,CAACI,YAAN,CAAmB,CAAnB,CAAtC,CAAP;AACD,OAFM,MAEA,IAAIJ,KAAK,CAACH,MAAV,EAAkB;AACvBE,QAAAA,cAAc,CAACC,KAAK,CAACH,MAAP,CAAd,GAA+B,IAA/B;AACD;AACF;;AAED5B,IAAAA,kBAAkB,CAAC+B,KAAD,CAAlB,CAhBS,CAgBkB;;AAE3B,QAAIA,KAAK,CAACb,OAAN,KAAkB,IAAtB,EAA4B;AAC1B3I,MAAAA,wBAAwB,CAACC,qBAAD,EAAwB,MAAM;AACpD;AACA,YAAIuJ,KAAK,CAAC9D,WAAV,EAAuB;AACrB8D,UAAAA,KAAK,CAAC9D,WAAN,CAAkBkC,aAAlB,GAAkC4B,KAAK,CAAC9D,WAAN,CAAkBkC,aAAlB,CAAgCsC,MAAhC,CAAuCO,CAAC,IAAIA,CAAC,KAAKjB,KAAlD,CAAlC;AACD,SAJmD,CAIlD;;;AAGFY,QAAAA,eAAe,CAACZ,KAAK,CAACL,SAAP,EAAkBK,KAAlB,CAAf;AACAY,QAAAA,eAAe,CAACZ,KAAK,CAACS,QAAP,EAAiBT,KAAjB,EAAwB,IAAxB,CAAf,CARoD,CAQN;;AAE9C,YAAIA,KAAK,CAACb,OAAV,EAAmBa,KAAK,CAACb,OAAN,GAAnB,KAAwC,IAAIa,KAAK,CAACX,SAAV,EAAqBW,KAAK,CAACX,SAAN,GAVT,CAU4B;;AAEhF,eAAOW,KAAK,CAAC9D,WAAb;AACA,eAAO8D,KAAK,CAACL,SAAb;AACD,OAduB,CAAxB;AAeD;AACF;AACF;;AAED,SAASuB,cAAT,CAAwBrF,QAAxB,EAAkC+C,IAAlC,EAAwC9C,QAAxC,EAAkDqF,KAAlD,EAAyD;AACvD,QAAM3C,MAAM,GAAG3C,QAAQ,CAAC2C,MAAxB;AACA,QAAM4C,WAAW,GAAGzC,cAAc,CAACC,IAAD,EAAO9C,QAAP,EAAiBD,QAAQ,CAACK,WAA1B,EAAuC,IAAvC,EAA6CiF,KAA7C,CAAlC;AACAJ,EAAAA,WAAW,CAACvC,MAAD,EAAS3C,QAAT,CAAX;AACAiE,EAAAA,WAAW,CAACtB,MAAD,EAAS4C,WAAT,CAAX,CAAiC;AACjC;AACA;AAFA;AAIA,GAACD,KAAD,EAAQA,KAAK,CAACE,SAAd,EAAyBtG,OAAzB,CAAiCoG,KAAK,IAAI;AACxC,QAAIA,KAAK,KAAK,IAAd,EAAoB;AAClBA,MAAAA,KAAK,CAACzB,SAAN,GAAkB0B,WAAlB;;AAEA,UAAID,KAAK,CAAChH,GAAV,EAAe;AACb,YAAIrC,EAAE,CAACK,GAAH,CAAOgJ,KAAK,CAAChH,GAAb,CAAJ,EAAuBgH,KAAK,CAAChH,GAAN,CAAUiH,WAAV,EAAvB,KAAmDD,KAAK,CAAChH,GAAN,CAAUJ,OAAV,GAAoBqH,WAApB;AACpD;AACF;AACF,GARD;AASD;;AAED,MAAME,QAAQ,GAAGhL,UAAU,CAAC;AAC1BiL,EAAAA,GAAG,EAAEhL,YADqB;AAE1BoI,EAAAA,cAF0B;AAG1BoC,EAAAA,WAH0B;AAI1BjB,EAAAA,WAJ0B;AAK1BO,EAAAA,YAL0B;AAM1B;AACAmB,EAAAA,gBAAgB,EAAE,IAPQ;AAQ1BC,EAAAA,gBAAgB,EAAE,IARQ;AAS1BC,EAAAA,iBAAiB,EAAE,KATO;AAU1BC,EAAAA,eAAe,EAAE7J,EAAE,CAACK,GAAH,CAAOyJ,UAAP,IAAqBA,UAArB,GAAkC/E,SAVzB;AAW1BgF,EAAAA,aAAa,EAAE/J,EAAE,CAACK,GAAH,CAAO2J,YAAP,IAAuBA,YAAvB,GAAsCjF,SAX3B;AAY1B;AACA+E,EAAAA,UAAU,EAAE9J,EAAE,CAACK,GAAH,CAAOyJ,UAAP,IAAqBA,UAArB,GAAkC/E,SAbpB;AAc1B;AACAiF,EAAAA,YAAY,EAAEhK,EAAE,CAACK,GAAH,CAAO2J,YAAP,IAAuBA,YAAvB,GAAsCjF,SAf1B;AAgB1BkF,EAAAA,SAAS,EAAE,CAAC,CAhBc;AAiB1BC,EAAAA,kBAAkB,EAAElC,WAjBM;AAkB1BmC,EAAAA,sBAAsB,EAAEnC,WAlBE;AAmB1BoC,EAAAA,wBAAwB,EAAEnB,WAnBA;AAoB1BoB,EAAAA,uBAAuB,EAAE9B,YApBC;;AAsB1B+B,EAAAA,YAAY,CAACvG,QAAD,EAAWwG,aAAX,EAA0BzD,IAA1B,EAAgC7C,QAAhC,EAA0CD,QAA1C,EAAoDqF,KAApD,EAA2D;AACrE,QAAItF,QAAQ,CAACa,UAAT,IAAuBZ,QAAQ,CAACsD,MAAhC,IAA0CtD,QAAQ,CAACsD,MAAT,KAAoBvD,QAAlE,EAA4E;AAC1E;AACAqF,MAAAA,cAAc,CAACrF,QAAD,EAAW+C,IAAX,EAAiB9C,QAAjB,EAA2BqF,KAA3B,CAAd;AACD,KAHD,MAGO;AACL;AACA,YAAM;AACJtC,QAAAA,IAAI,EAAEyD,OAAO,GAAG,EADZ;AAEJ,WAAGC;AAFC,UAGFzG,QAHJ;AAIA,YAAM;AACJ+C,QAAAA,IAAI,EAAE2D,OAAO,GAAG,EADZ;AAEJ,WAAGC;AAFC,UAGF1G,QAHJ,CANK,CASS;;AAEd,YAAM2G,UAAU,GAAGJ,OAAO,CAACK,IAAR,CAAa,CAAC1F,KAAD,EAAQlE,KAAR,KAAkBjB,EAAE,CAACC,GAAH,CAAOkF,KAAP,IAAgBhF,MAAM,CAAC8E,OAAP,CAAeE,KAAf,EAAsB0F,IAAtB,CAA2B,CAAC,CAAC3F,GAAD,EAAM4F,GAAN,CAAD,KAAgBA,GAAG,KAAKJ,OAAO,CAACzJ,KAAD,CAAP,CAAeiE,GAAf,CAAnD,CAAhB,GAA0FC,KAAK,KAAKuF,OAAO,CAACzJ,KAAD,CAA1I,CAAnB;;AAEA,UAAI2J,UAAJ,EAAgB;AACd;AACAxB,QAAAA,cAAc,CAACrF,QAAD,EAAW+C,IAAX,EAAiB9C,QAAjB,EAA2BqF,KAA3B,CAAd;AACD,OAHD,MAGO;AACL;AACAvF,QAAAA,UAAU,CAACC,QAAD,EAAW0G,OAAX,EAAoBE,OAApB,EAA6B,IAA7B,CAAV;AACD;AACF;AACF,GA/CyB;;AAiD1BI,EAAAA,YAAY,CAAChH,QAAD,EAAW;AACrB,QAAIA,QAAQ,CAACoE,UAAb,EAAyB;AACvBpE,MAAAA,QAAQ,CAACiH,OAAT,GAAmB,KAAnB;AACA7E,MAAAA,kBAAkB,CAACpC,QAAD,CAAlB;AACD;AACF,GAtDyB;;AAwD1BkH,EAAAA,cAAc,CAAClH,QAAD,EAAWiD,KAAX,EAAkB;AAC9B,QAAIjD,QAAQ,CAACoE,UAAT,IAAuBnB,KAAK,CAACgE,OAAN,IAAiB,IAAxC,IAAgDhE,KAAK,CAACgE,OAA1D,EAAmE;AACjEjH,MAAAA,QAAQ,CAACiH,OAAT,GAAmB,IAAnB;AACA7E,MAAAA,kBAAkB,CAACpC,QAAD,CAAlB;AACD;AACF,GA7DyB;;AA+D1BmH,EAAAA,gBAAgB,GAAG;AACjB,UAAM,IAAIC,KAAJ,CAAU,2GAAV,CAAN;AACD,GAjEyB;;AAmE1BC,EAAAA,iBAAiB,CAACrH,QAAD,EAAW;AAC1B,WAAOA,QAAP;AACD,GArEyB;;AAuE1BsH,EAAAA,kBAAkB,GAAG;AACnB,WAAOtL,WAAP;AACD,GAzEyB;;AA2E1BuL,EAAAA,mBAAmB,GAAG;AACpB,WAAOvL,WAAP;AACD,GA7EyB;;AA+E1BwL,EAAAA,kBAAkB,GAAG,CAAE,CA/EG;;AAiF1BC,EAAAA,uBAAuB,GAAG;AACxB,WAAO,KAAP;AACD,GAnFyB;;AAqF1BC,EAAAA,aAAa,GAAG;AACd,WAAO1L,WAAP;AACD,GAvFyB;;AAyF1B2L,EAAAA,yBAAyB,GAAG;AAC1B,WAAO,KAAP;AACD,GA3FyB;;AA6F1BC,EAAAA,gBAAgB,GAAG;AACjB,WAAO,IAAP;AACD,GA/FyB;;AAiG1BC,EAAAA,kBAAkB,GAAG;AACnB,WAAO,IAAP;AACD,GAnGyB;;AAqG1BC,EAAAA,gBAAgB,GAAG,CAAE,CArGK;;AAuG1BC,EAAAA,oBAAoB,GAAG;AACrB,WAAO,KAAP;AACD,GAzGyB;;AA2G1BC,EAAAA,cAAc,GAAG;AACf,WAAO,KAAP;AACD;;AA7GyB,CAAD,CAA3B;AAgHA,MAAMC,SAAS,GAAGhM,EAAE,CAACK,GAAH,CAAO4L,MAAP,KAAkBA,MAAM,CAACC,GAA3C;AACA,MAAMC,iBAAiB,GAAGH,SAAS,GAAGC,MAAM,CAACC,GAAP,CAAW,cAAX,CAAH,GAAgC,MAAnE;;AACA,SAAStJ,MAAT,CAAgBwJ,OAAhB,EAAyBjI,SAAzB,EAAoCvC,KAApC,EAA2C;AACzC,MAAIsB,IAAI,GAAGrD,KAAK,CAACwM,GAAN,CAAUlI,SAAV,CAAX;;AAEA,MAAI,CAACjB,IAAL,EAAW;AACTiB,IAAAA,SAAS,CAACf,OAAV,GAAoBxB,KAApB,CADS,CACkB;;AAE3B,QAAI0K,OAAO,GAAGpJ,IAAI,GAAGsG,QAAQ,CAAC+C,eAAT,CAAyBpI,SAAzB,EAAoCvC,KAAK,KAAKmD,SAAV,IAAuBnD,KAAK,CAACK,OAAN,CAAcuK,UAArC,GAAkD,CAAlD,GAAsD,CAA1F,EAA6F,KAA7F,EAAoG;AACzH,QADqB,CAArB;AAEA3M,IAAAA,KAAK,CAAC6F,GAAN,CAAUvB,SAAV,EAAqBmI,OAArB;AACD;;AAED9C,EAAAA,QAAQ,CAACiD,eAAT,CAAyBL,OAAzB,EAAkClJ,IAAlC,EAAwC,IAAxC,EAA8C,MAAM6B,SAApD;AACA,SAAOyE,QAAQ,CAACkD,qBAAT,CAA+BxJ,IAA/B,CAAP;AACD;;AACD,SAASyJ,sBAAT,CAAgCxI,SAAhC,EAA2CpD,QAA3C,EAAqD;AACnD,QAAMmC,IAAI,GAAGrD,KAAK,CAACwM,GAAN,CAAUlI,SAAV,CAAb;;AAEA,MAAIjB,IAAJ,EAAU;AACRsG,IAAAA,QAAQ,CAACiD,eAAT,CAAyB,IAAzB,EAA+BvJ,IAA/B,EAAqC,IAArC,EAA2C,MAAM;AAC/CrD,MAAAA,KAAK,CAAC+M,MAAN,CAAazI,SAAb;AACA,UAAIpD,QAAJ,EAAcA,QAAQ,CAACoD,SAAD,CAAR;AACf,KAHD;AAID;AACF;;AACD,SAAS0I,YAAT,CAAsBlE,QAAtB,EAAgCxF,aAAhC,EAA+C2J,cAA/C,EAA+D5H,GAAG,GAAG,IAArE,EAA2E;AACzE,MAAI,CAAC/B,aAAa,CAAC0E,SAAnB,EAA8B1E,aAAa,CAAC0E,SAAd,GAA0B,EAA1B;AAC9B,SAAO;AACLkF,IAAAA,QAAQ,EAAEZ,iBADL;AAELjH,IAAAA,GAAG,EAAEA,GAAG,IAAI,IAAP,GAAc,IAAd,GAAqB,KAAKA,GAF1B;AAGLyD,IAAAA,QAHK;AAILxF,IAAAA,aAJK;AAKL2J,IAAAA;AALK,GAAP;AAOD;;AACDtD,QAAQ,CAACwD,kBAAT,CAA4B;AAC1BC,EAAAA,UAAU,EAAEC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC,CAAxC,GAA4C,CAD9B;AAE1B;AACAC,EAAAA,uBAAuB,EAAE,MAAM,IAHL;AAI1BzN,EAAAA,OAAO,EAAEA,OAJiB;AAK1B0N,EAAAA,mBAAmB,EAAE3N;AALK,CAA5B;;AAQA,SAAS4N,oBAAT,CAA8BC,GAA9B,EAAmC;AACjC,SAAOA,GAAG,CAACD,oBAAX;AACD;;AAED,SAASE,MAAT,CAAgBC,KAAhB,EAAuB;AACrB,SAAO,CAACA,KAAK,CAACC,WAAN,IAAqBD,KAAK,CAACpG,MAA5B,EAAoCsG,IAApC,GAA2C,GAA3C,GAAiDF,KAAK,CAACzM,KAA9D;AACD;;AAED,MAAM4M,YAAY,GAAG,aAAahP,aAAa,CAAC,EAAD,CAA/C;;AACA,MAAMiP,SAAS,GAAG9G,KAAK,IAAI;AACzB,QAAM;AACJ2B,IAAAA,QADI;AAEJhG,IAAAA,EAFI;AAGJG,IAAAA,MAHI;AAIJiL,IAAAA,YAJI;AAKJC,IAAAA,SALI;AAMJC,IAAAA,IANI;AAOJC,IAAAA,UAPI;AAQJzK,IAAAA,EAAE,GAAG,KARD;AASJ+I,IAAAA,UAAU,GAAG,KATT;AAUJ2B,IAAAA,SAAS,GAAG,KAVR;AAWJrI,IAAAA,eAAe,GAAG,IAXd;AAYJrD,IAAAA,mBAAmB,GAAG,KAZlB;AAaJ2L,IAAAA,mBAAmB,GAAG,IAblB;AAcJC,IAAAA,QAAQ,GAAG,KAdP;AAeJC,IAAAA,SAfI;AAgBJC,IAAAA,eAhBI;AAiBJ7K,IAAAA;AAjBI,MAkBFsD,KAlBJ,CADyB,CAmBd;;AAEX,QAAM,CAAC1D,KAAD,EAAQkL,QAAR,IAAoB1P,QAAQ,CAAC,KAAD,CAAlC;AACA,QAAM,CAAC2P,KAAD,IAAU3P,QAAQ,CAAC,MAAM,IAAIjB,OAAJ,EAAP,CAAxB;AACA,QAAM,CAAC6Q,gBAAD,IAAqB5P,QAAQ,CAAC,MAAM;AACxC,UAAM6P,GAAG,GAAG,IAAI7Q,SAAJ,EAAZ;;AAEA,QAAIkQ,SAAJ,EAAe;AACb,YAAM;AACJpF,QAAAA,MADI;AAEJgG,QAAAA,cAFI;AAGJ,WAAGC;AAHC,UAIFb,SAJJ;AAKAlK,MAAAA,UAAU,CAAC6K,GAAD,EAAME,cAAN,EAAsB,EAAtB,CAAV;AACD;;AAED,WAAOF,GAAP;AACD,GAbkC,CAAnC;AAcA,QAAM,CAACG,YAAD,IAAiBhQ,QAAQ,CAAC,MAAM;AACpC,UAAM+D,KAAK,GAAG,IAAI9E,KAAJ,EAAd;AACA8E,IAAAA,KAAK,CAACyD,aAAN,GAAsB,EAAtB;AACAzD,IAAAA,KAAK,CAACgF,SAAN,GAAkB,EAAlB;AACA,WAAOhF,KAAP;AACD,GAL8B,CAA/B;AAMA,QAAM,CAACkM,UAAD,EAAaC,gBAAb,IAAiClQ,QAAQ,CAAC,MAAM;AACpD,UAAMmQ,GAAG,GAAGlB,YAAY,GAAG,IAAI/P,kBAAJ,CAAuB,CAAvB,EAA0B,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,GAAnC,EAAwC,IAAxC,CAAH,GAAmD,IAAIC,iBAAJ,CAAsB,EAAtB,EAA0B,CAA1B,EAA6B,GAA7B,EAAkC,IAAlC,CAA3E;AACAgR,IAAAA,GAAG,CAACC,QAAJ,CAAaC,CAAb,GAAiB,CAAjB;AACA,QAAIrM,MAAJ,EAAYgB,UAAU,CAACmL,GAAD,EAAMnM,MAAN,EAAc,EAAd,CAAV,CAHwC,CAGX;;AAEzCmM,IAAAA,GAAG,CAACG,MAAJ,CAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB;AACA,WAAOH,GAAP;AACD,GAP8C,CAA/C;AAQA,QAAM,CAAC/M,KAAD,IAAUpD,QAAQ,CAAC,MAAM,IAAIZ,KAAJ,EAAP,CAAxB,CAnDyB,CAmDoB;;AAE7C,QAAM0D,KAAK,GAAG7C,MAAM,CAAC;AACnBuE,IAAAA,KAAK,EAAE,KADY;AAEnBD,IAAAA,MAAM,EAAE,IAFW;AAGnBX,IAAAA,MAAM,EAAE,CAHW;AAInBoD,IAAAA,eAJmB;AAKnBrC,IAAAA,EALmB;AAMnB+I,IAAAA,UANmB;AAOnB6B,IAAAA,QAPmB;AAQnB5L,IAAAA,mBAAmB,EAAE,KARF;AASnBH,IAAAA,MAAM,EAAE,CATW;AAUnB+M,IAAAA,MAAM,EAAE,CAVW;AAWnBjN,IAAAA,WAAW,EAAE,EAXM;AAYnBU,IAAAA,MAAM,EAAEiM,UAZW;AAanBlM,IAAAA,KAAK,EAAEiM,YAbY;AAcnBd,IAAAA,SAAS,EAAEU,gBAdQ;AAenBD,IAAAA,KAfmB;AAgBnBvM,IAAAA,KAhBmB;AAiBnBS,IAAAA,EAjBmB;AAkBnBsL,IAAAA,IAlBmB;AAmBnBqB,IAAAA,QAAQ,EAAE,IAnBS;AAoBnBC,IAAAA,YAAY,EAAE,CAAC,CAAD,EAAI,CAAJ,CApBK;AAqBnBC,IAAAA,WAAW,EAAE,EArBM;AAsBnBC,IAAAA,OAAO,EAAE,IAAInQ,WAAJ,EAtBU;AAuBnBoQ,IAAAA,QAAQ,EAAE3K,SAvBS;AAwBnB4K,IAAAA,MAAM,EAAE5K,SAxBW;AAyBnB6K,IAAAA,SAAS,EAAE,CAACvN,GAAD,EAAMwN,QAAQ,GAAG,CAAjB,KAAuB;AAChC;AACA;AACA;AACA;AACA,UAAIA,QAAJ,EAAcjO,KAAK,CAACK,OAAN,CAAcS,MAAd;AACdd,MAAAA,KAAK,CAACK,OAAN,CAAcG,WAAd,CAA0BjB,IAA1B,CAA+B;AAC7BkB,QAAAA,GAD6B;AAE7BwN,QAAAA,QAAQ,EAAEA;AAFmB,OAA/B,EANgC,CAS5B;;AAEJjO,MAAAA,KAAK,CAACK,OAAN,CAAcG,WAAd,GAA4BR,KAAK,CAACK,OAAN,CAAcG,WAAd,CAA0B0N,IAA1B,CAA+B,CAAC5P,CAAD,EAAIU,CAAJ,KAAUV,CAAC,CAAC2P,QAAF,GAAajP,CAAC,CAACiP,QAAxD,CAA5B;AACA,aAAO,MAAM;AACX,YAAIE,cAAJ;;AAEA,YAAI,CAACA,cAAc,GAAGnO,KAAK,CAACK,OAAxB,KAAoC,IAApC,GAA2C,KAAK,CAAhD,GAAoD8N,cAAc,CAAC3N,WAAvE,EAAoF;AAClF;AACA,cAAIyN,QAAJ,EAAcjO,KAAK,CAACK,OAAN,CAAcS,MAAd;AACdd,UAAAA,KAAK,CAACK,OAAN,CAAcG,WAAd,GAA4BR,KAAK,CAACK,OAAN,CAAcG,WAAd,CAA0BwG,MAA1B,CAAiCoH,CAAC,IAAIA,CAAC,CAAC3N,GAAF,KAAUA,GAAhD,CAA5B;AACD;AACF,OARD;AASD,KA9CkB;AA+CnB2M,IAAAA,gBAAgB,EAAElM,MAAM,IAAIkM,gBAAgB,CAAClM,MAAD,CA/CzB;AAgDnBU,IAAAA,UAAU,EAAE,MAAMA,UAAU,CAAC5B,KAAD,CAhDT;AAiDnBqO,IAAAA,SAAS,EAAE,CAACvC,KAAK,GAAG,EAAT,EAAawC,OAAO,GAAG,IAAvB,KAAgCC,iBAAiB,CAACzC,KAAD,EAAQwC,OAAR,CAjDzC;AAkDnBxM,IAAAA;AAlDmB,GAAD,CAApB;AAoDA,QAAM0M,kBAAkB,GAAGpR,WAAW,CAAC,CAAC8D,MAAM,GAAGlB,KAAK,CAACK,OAAN,CAAca,MAAxB,EAAgCwC,MAAM,GAAG,IAAInH,OAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAzC,KAAkE;AACvG,UAAM;AACJkS,MAAAA,KADI;AAEJC,MAAAA;AAFI,QAGF1O,KAAK,CAACK,OAAN,CAAcgM,IAHlB;AAIA,UAAMsC,QAAQ,GAAGzN,MAAM,CAACoM,QAAP,CAAgBsB,UAAhB,CAA2BlL,MAA3B,CAAjB;;AAEA,QAAIiI,oBAAoB,CAACzK,MAAD,CAAxB,EAAkC;AAChC,aAAO;AACLuN,QAAAA,KAAK,EAAEA,KAAK,GAAGvN,MAAM,CAAC2N,IADjB;AAELH,QAAAA,MAAM,EAAEA,MAAM,GAAGxN,MAAM,CAAC2N,IAFnB;AAGLC,QAAAA,MAAM,EAAE,CAHH;AAILH,QAAAA;AAJK,OAAP;AAMD,KAPD,MAOO;AACL,YAAMI,GAAG,GAAG7N,MAAM,CAAC6N,GAAP,GAAapO,IAAI,CAACqO,EAAlB,GAAuB,GAAnC,CADK,CACmC;;AAExC,YAAMC,CAAC,GAAG,IAAItO,IAAI,CAACuO,GAAL,CAASH,GAAG,GAAG,CAAf,CAAJ,GAAwBJ,QAAlC,CAHK,CAGuC;;AAE5C,YAAMQ,CAAC,GAAGF,CAAC,IAAIR,KAAK,GAAGC,MAAZ,CAAX;AACA,aAAO;AACLD,QAAAA,KAAK,EAAEU,CADF;AAELT,QAAAA,MAAM,EAAEO,CAFH;AAGLH,QAAAA,MAAM,EAAEL,KAAK,GAAGU,CAHX;AAILR,QAAAA;AAJK,OAAP;AAMD;AACF,GA3BqC,EA2BnC,EA3BmC,CAAtC,CAzGyB,CAoIjB;;AAERtR,EAAAA,OAAO,CAAC,MAAM;AACZ2C,IAAAA,KAAK,CAACK,OAAN,CAAcqB,KAAd,GAAsBA,KAAtB;AACA1B,IAAAA,KAAK,CAACK,OAAN,CAAcgM,IAAd,GAAqBA,IAArB;AACArM,IAAAA,KAAK,CAACK,OAAN,CAAca,MAAd,GAAuBiM,UAAvB;AACAnN,IAAAA,KAAK,CAACK,OAAN,CAAcQ,mBAAd,GAAoCA,mBAApC;AACAb,IAAAA,KAAK,CAACK,OAAN,CAAcwB,EAAd,GAAmBA,EAAnB;AACA7B,IAAAA,KAAK,CAACK,OAAN,CAAcU,EAAd,GAAmBA,EAAnB;AACAf,IAAAA,KAAK,CAACK,OAAN,CAAcuK,UAAd,GAA2BA,UAA3B;AACA5K,IAAAA,KAAK,CAACK,OAAN,CAAcoM,QAAd,GAAyBA,QAAzB,CARY,CAQuB;;AAEnCzM,IAAAA,KAAK,CAACK,OAAN,CAAcqN,QAAd,GAAyBc,kBAAzB;AACD,GAXM,EAWJ,CAAC3N,mBAAD,EAAsBgB,EAAtB,EAA0B+I,UAA1B,EAAsC6B,QAAtC,EAAgD/K,KAAhD,EAAuD2K,IAAvD,EAA6Dc,UAA7D,EAAyEpM,EAAzE,CAXI,CAAP,CAtIyB,CAiJyD;;AAElF1D,EAAAA,OAAO,CAAC,MAAM;AACZ2C,IAAAA,KAAK,CAACK,OAAN,CAAcoN,MAAd,GAAuBpB,IAAI,CAACoC,KAAL,GAAapC,IAAI,CAACqC,MAAzC,CADY,CACqC;;AAEjDnQ,IAAAA,MAAM,CAAC6Q,MAAP,CAAcpP,KAAK,CAACK,OAAN,CAAcqN,QAA5B,EAAsCc,kBAAkB,EAAxD,EAHY,CAGiD;AAC7D;;AAEA,QAAIhC,mBAAJ,EAAyB;AACvB,UAAIb,oBAAoB,CAACwB,UAAD,CAAxB,EAAsC;AACpCA,QAAAA,UAAU,CAACkC,IAAX,GAAkBhD,IAAI,CAACoC,KAAL,GAAa,CAAC,CAAhC;AACAtB,QAAAA,UAAU,CAACmC,KAAX,GAAmBjD,IAAI,CAACoC,KAAL,GAAa,CAAhC;AACAtB,QAAAA,UAAU,CAACoC,GAAX,GAAiBlD,IAAI,CAACqC,MAAL,GAAc,CAA/B;AACAvB,QAAAA,UAAU,CAACqC,MAAX,GAAoBnD,IAAI,CAACqC,MAAL,GAAc,CAAC,CAAnC;AACD,OALD,MAKO;AACLvB,QAAAA,UAAU,CAACM,MAAX,GAAoBzN,KAAK,CAACK,OAAN,CAAcoN,MAAlC;AACD;;AAEDN,MAAAA,UAAU,CAACsC,sBAAX,GAVuB,CAUc;AACrC;;AAEAtC,MAAAA,UAAU,CAACuC,iBAAX;AACD;;AAED3O,IAAAA,EAAE,CAAC4O,OAAH,CAAWtD,IAAI,CAACoC,KAAhB,EAAuBpC,IAAI,CAACqC,MAA5B;AACA,QAAIhN,KAAJ,EAAWE,UAAU,CAAC5B,KAAD,CAAV;AACZ,GAxBM,EAwBJ,CAACmN,UAAD,EAAapM,EAAb,EAAiBsL,IAAjB,EAAuBG,mBAAvB,CAxBI,CAAP;AAyBA;;AAEA,QAAMoD,OAAO,GAAGvS,OAAO,CAAC,MAAM,IAAIa,GAAJ,EAAP,EAAkB,EAAlB,CAAvB;AACA,QAAM2R,IAAI,GAAG,IAAItT,OAAJ,EAAb;AACA;;AAEA,QAAMuT,UAAU,GAAG1S,WAAW,CAAC0O,KAAK,IAAI;AACtC;AACA;AACA,UAAMiE,OAAO,GAAG,CAAC3D,SAAS,IAAI,IAAb,GAAoB,KAAK,CAAzB,GAA6BA,SAAS,CAACY,cAAV,IAA4B,IAA5B,GAAmC,KAAK,CAAxC,GAA4CZ,SAAS,CAACY,cAAV,CAAyBlB,KAAzB,CAA1E,KAA8GA,KAAK,CAACkE,WAApI;;AAEA,QAAID,OAAJ,EAAa;AACX,YAAM;AACJE,QAAAA,OADI;AAEJC,QAAAA;AAFI,UAGFH,OAHJ;AAIA,YAAM;AACJtB,QAAAA,KADI;AAEJC,QAAAA;AAFI,UAGF1O,KAAK,CAACK,OAAN,CAAcgM,IAHlB;AAIAQ,MAAAA,KAAK,CAAC/I,GAAN,CAAUmM,OAAO,GAAGxB,KAAV,GAAkB,CAAlB,GAAsB,CAAhC,EAAmC,EAAEyB,OAAO,GAAGxB,MAAZ,IAAsB,CAAtB,GAA0B,CAA7D;AACA5B,MAAAA,gBAAgB,CAACqD,aAAjB,CAA+BtD,KAA/B,EAAsC7M,KAAK,CAACK,OAAN,CAAca,MAApD;AACD,KAhBqC,CAgBpC;;AAEH,GAlB6B,EAkB3B,EAlB2B,CAA9B;AAmBA;;AAEA,QAAMmN,SAAS,GAAGjR,WAAW,CAAC,CAAC0O,KAAD,EAAQ9E,MAAR,KAAmB;AAC/C;AACA,QAAIhH,KAAK,CAACK,OAAN,CAAcoM,QAAlB,EAA4B,OAAO,EAAP;AAC5B,UAAM2D,IAAI,GAAG,IAAIC,GAAJ,EAAb;AACA,UAAMC,IAAI,GAAG,EAAb,CAJ+C,CAI9B;;AAEjB,UAAMC,aAAa,GAAGvJ,MAAM,GAAGA,MAAM,CAAChH,KAAK,CAACK,OAAN,CAAcY,KAAd,CAAoByD,aAArB,CAAT,GAA+C1E,KAAK,CAACK,OAAN,CAAcY,KAAd,CAAoByD,aAA/F,CAN+C,CAM+D;;AAE9G,QAAI8L,UAAU,GAAG1D,gBAAgB,CAAC2D,gBAAjB,CAAkCF,aAAlC,EAAiD,IAAjD,EAAuDvJ,MAAvD,CAA8D0J,IAAI,IAAI;AACrF,YAAMC,EAAE,GAAG9E,MAAM,CAAC6E,IAAD,CAAjB;AACA,UAAIN,IAAI,CAACxK,GAAL,CAAS+K,EAAT,CAAJ,EAAkB,OAAO,KAAP;AAClBP,MAAAA,IAAI,CAAC5J,GAAL,CAASmK,EAAT;AACA,aAAO,IAAP;AACD,KALgB,CAAjB,CAR+C,CAa3C;AACJ;;AAEA,QAAIvE,SAAS,IAAIA,SAAS,CAACpF,MAAvB,IAAiC4J,WAAW,CAACvQ,OAAjD,EAA0D;AACxDmQ,MAAAA,UAAU,GAAGpE,SAAS,CAACpF,MAAV,CAAiBwJ,UAAjB,EAA6BI,WAAW,CAACvQ,OAAzC,CAAb;AACD;;AAED,SAAK,MAAMgO,SAAX,IAAwBmC,UAAxB,EAAoC;AAClC,UAAIzE,WAAW,GAAGsC,SAAS,CAAC3I,MAA5B,CADkC,CACE;;AAEpC,aAAOqG,WAAP,EAAoB;AAClB,cAAMrJ,QAAQ,GAAGqJ,WAAW,CAACtH,UAA7B;AACA,YAAI/B,QAAJ,EAAc4N,IAAI,CAAC/Q,IAAL,CAAU,EAAE,GAAG8O,SAAL;AACtBtC,UAAAA;AADsB,SAAV;AAGdA,QAAAA,WAAW,GAAGA,WAAW,CAACjH,MAA1B;AACD;AACF;;AAED,WAAOwL,IAAP;AACD,GAjC4B,EAiC1B;AACH,IAlC6B,CAA7B;AAmCA;;AAEA,QAAMO,iBAAiB,GAAGzT,WAAW,CAAC0O,KAAK,IAAI;AAC7C,UAAMgF,EAAE,GAAGhF,KAAK,CAACkE,WAAN,CAAkBC,OAAlB,GAA4BjQ,KAAK,CAACK,OAAN,CAAcsN,YAAd,CAA2B,CAA3B,CAAvC;AACA,UAAMoD,EAAE,GAAGjF,KAAK,CAACkE,WAAN,CAAkBE,OAAlB,GAA4BlQ,KAAK,CAACK,OAAN,CAAcsN,YAAd,CAA2B,CAA3B,CAAvC;AACA,WAAOhN,IAAI,CAACqQ,KAAL,CAAWrQ,IAAI,CAACsQ,IAAL,CAAUH,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAAzB,CAAX,CAAP;AACD,GAJoC,EAIlC,EAJkC,CAArC;AAKA,QAAMG,mBAAmB,GAAG9T,WAAW,CAAC,CAAC0O,KAAD,EAAQwE,IAAR,EAAchC,OAAO,GAAG,IAAxB,KAAiC;AACvEtO,IAAAA,KAAK,CAACK,OAAN,CAAcwN,OAAd,CAAsBsD,IAAtB,CAA2B,eAA3B,EAA4CrF,KAA5C;AACA,QAAIwC,OAAJ,EAAawB,UAAU,CAAChE,KAAD,CAAV,CAF0D,CAEvC;AAChC;;AAEAjN,IAAAA,KAAK,CAACuS,IAAN,CAAWxB,OAAO,CAACyB,MAAR,EAAX,EAA6BhQ,OAA7B,CAAqCiQ,IAAI,IAAI;AAC3C;AACA;AACA,UAAIhB,IAAI,KAAK,CAACA,IAAI,CAAChR,MAAN,IAAgB,CAACgR,IAAI,CAACiB,IAAL,CAAUtS,CAAC,IAAIA,CAAC,CAAC8M,WAAF,KAAkBuF,IAAI,CAACvF,WAAtC,CAAtB,CAAR,EAAmF;AACjF,cAAMA,WAAW,GAAGuF,IAAI,CAACvF,WAAzB;AACA,cAAMrJ,QAAQ,GAAGqJ,WAAW,CAACtH,UAA7B;AACAmL,QAAAA,OAAO,CAAC5E,MAAR,CAAea,MAAM,CAACyF,IAAD,CAArB;;AAEA,YAAI5O,QAAJ,EAAc;AACZ,cAAIA,QAAQ,CAAC8O,UAAb,EAAyB9O,QAAQ,CAAC8O,UAAT,CAAoB,EAAE,GAAGF,IAAL;AAC3CpM,YAAAA,IAAI,EAAE;AADqC,WAApB;AAGzB,cAAIxC,QAAQ,CAAC+O,YAAb,EAA2B/O,QAAQ,CAAC+O,YAAT,CAAsB,EAAE,GAAGH,IAAL;AAC/CpM,YAAAA,IAAI,EAAE;AADyC,WAAtB;AAG5B;AACF;AACF,KAjBD,EALuE,CAsBnE;AACL,GAvBsC,EAuBpC,EAvBoC,CAAvC;AAwBA;;AAEA,QAAMwM,aAAa,GAAGtU,WAAW,CAAC,CAAC0O,KAAD,EAAQ9E,MAAR,KAAmB;AACnD;AACA,UAAM2K,aAAa,GAAGtD,SAAS,CAACvC,KAAD,EAAQ9E,MAAR,CAA/B,CAFmD,CAEH;;AAEhD,QAAIhH,KAAK,CAACK,OAAN,CAAcyN,QAAd,IAA0BhC,KAAK,CAAC5G,IAAN,KAAe,OAAzC,IAAoD4G,KAAK,CAAC5G,IAAN,KAAe,OAAvE,EAAgF;AAC9ElF,MAAAA,KAAK,CAACK,OAAN,CAAcyN,QAAd,CAAuBzM,OAAvB,CAA+ByM,QAAQ,IAAI;AACzC,YAAI,CAAC6D,aAAa,CAACJ,IAAd,CAAmBK,GAAG,IAAIA,GAAG,CAAC7F,WAAJ,KAAoB+B,QAAQ,CAAC/B,WAAvD,CAAL,EAA0E4F,aAAa,CAACpS,IAAd,CAAmBuO,QAAnB;AAC3E,OAFD;AAGD;;AAED,WAAO6D,aAAP;AACD,GAXgC,EAW9B;AACH,IAZiC,CAAjC;AAaA;;AAEA,QAAME,gBAAgB,GAAGzU,WAAW,CAAC,CAACuU,aAAD,EAAgB7F,KAAhB,EAAuBjG,EAAvB,KAA8B;AACjE;AACA,QAAI8L,aAAa,CAACrS,MAAlB,EAA0B;AACxB,YAAMwS,gBAAgB,GAAGjC,IAAI,CAAC/L,GAAL,CAAS+I,KAAK,CAACtF,CAAf,EAAkBsF,KAAK,CAACkF,CAAxB,EAA2B,CAA3B,EAA8BC,SAA9B,CAAwChS,KAAK,CAACK,OAAN,CAAca,MAAtD,CAAzB;AACA,YAAMd,KAAK,GAAG0L,KAAK,CAAC5G,IAAN,KAAe,OAAf,GAAyB2L,iBAAiB,CAAC/E,KAAD,CAA1C,GAAoD,CAAlE;;AAEA,YAAMmG,qBAAqB,GAAGtB,EAAE,IAAI7E,KAAK,CAACpI,MAAN,CAAauO,qBAAb,CAAmCtB,EAAnC,CAApC;;AAEA,YAAMuB,UAAU,GAAG;AACjBC,QAAAA,OAAO,EAAE,KADQ;AAEjBrE,QAAAA,QAAQ,EAAE;AAFO,OAAnB;;AAKA,WAAK,MAAM8D,GAAX,IAAkBD,aAAlB,EAAiC;AAC/B,cAAMS,iBAAiB,GAAGzB,EAAE,IAAI;AAC9B;AACA,cAAI,CAACuB,UAAU,CAACpE,QAAhB,EAA0B;AACxBoE,YAAAA,UAAU,CAACpE,QAAX,GAAsB,IAAtB,CADwB,CACI;;AAE5B9N,YAAAA,KAAK,CAACK,OAAN,CAAcyN,QAAd,GAAyB,EAAzB;AACD,WAN6B,CAM5B;;;AAGF,cAAI9N,KAAK,CAACK,OAAN,CAAcyN,QAAlB,EAA4B;AAC1B9N,YAAAA,KAAK,CAACK,OAAN,CAAcyN,QAAd,CAAuBvO,IAAvB,CAA4BqS,GAA5B;AACD,WAX6B,CAW5B;;;AACF9F,UAAAA,KAAK,CAACpI,MAAN,CAAa0O,iBAAb,CAA+BzB,EAA/B;AACD,SAbD;;AAeA,cAAM0B,YAAY,GAAG,EAAE,GAAGvG,KAAL;AACnB,aAAG8F,GADgB;AAEnBD,UAAAA,aAFmB;AAGnBQ,UAAAA,OAAO,EAAED,UAAU,CAACC,OAHD;AAInB/R,UAAAA,KAJmB;AAKnB0R,UAAAA,gBALmB;AAMnB/E,UAAAA,GAAG,EAAED,gBAAgB,CAACC,GANH;AAOnB7L,UAAAA,MAAM,EAAElB,KAAK,CAACK,OAAN,CAAca,MAPH;AAQnB;AACAoR,UAAAA,eAAe,EAAE,MAAM;AACrB;AACA;AACA,kBAAMC,GAAG,GAAGvS,KAAK,CAACK,OAAN,CAAcyN,QAA1B;;AAEA,gBAAI,CAACyE,GAAD,IAAQA,GAAG,CAAChB,IAAJ,CAAStC,CAAC,IAAIA,CAAC,CAAClD,WAAF,CAAc4E,EAAd,KAAqBiB,GAAG,CAAC7F,WAAJ,CAAgB4E,EAAnD,CAAZ,EAAoE;AAClE0B,cAAAA,YAAY,CAACF,OAAb,GAAuBD,UAAU,CAACC,OAAX,GAAqB,IAA5C,CADkE,CAChB;AAClD;;AAEA,kBAAIvC,OAAO,CAACvD,IAAR,IAAgBxN,KAAK,CAACuS,IAAN,CAAWxB,OAAO,CAACyB,MAAR,EAAX,EAA6BE,IAA7B,CAAkCtS,CAAC,IAAIA,CAAC,CAACyG,MAAF,KAAakM,GAAG,CAAClM,MAAxD,CAApB,EAAqFwL,mBAAmB,CAACmB,YAAD,EAAe,CAACT,GAAD,CAAf,CAAnB;AACtF;AACF,WApBkB;AAqBnBlO,UAAAA,MAAM,EAAE,EAAE,GAAGoI,KAAK,CAACpI,MAAX;AACN0O,YAAAA,iBADM;AAENH,YAAAA;AAFM,WArBW;AAyBnBO,UAAAA,aAAa,EAAE,EAAE,GAAG1G,KAAK,CAAC0G,aAAX;AACbJ,YAAAA,iBADa;AAEbH,YAAAA;AAFa,WAzBI;AA6BnBQ,UAAAA,WAAW,EAAE3G;AA7BM,SAArB;AA+BAjG,QAAAA,EAAE,CAACwM,YAAD,CAAF,CA/C+B,CA+Cb;;AAElB,YAAIH,UAAU,CAACC,OAAX,KAAuB,IAA3B,EAAiC;AAClC;AACF;;AAED,WAAOR,aAAP;AACD,GAnEmC,EAmEjC;AACH,IApEoC,CAApC;AAqEA,QAAMpD,iBAAiB,GAAGnR,WAAW,CAAC,CAAC0O,KAAD,EAAQwC,OAAO,GAAG,IAAlB,KAA2B;AAC/DtO,IAAAA,KAAK,CAACK,OAAN,CAAcwN,OAAd,CAAsBsD,IAAtB,CAA2B,aAA3B,EAA0CrF,KAA1C;AACA,QAAIwC,OAAJ,EAAawB,UAAU,CAAChE,KAAD,CAAV;AACb,UAAMwE,IAAI,GAAGoB,aAAa,CAAC5F,KAAD,EAAQ;AAClC7J,IAAAA,OAAO,IAAIA,OAAO,CAAC+E,MAAR,CAAe3I,GAAG,IAAI,CAAC,MAAD,EAAS,MAAT,EAAiB,OAAjB,EAA0B,KAA1B,EAAiC,OAAjC,EAA0C4K,IAA1C,CAA+ClL,IAAI,IAAIM,GAAG,CAACoG,UAAJ,CAAe,YAAY1G,IAA3B,CAAvD,CAAtB,CADe,CAA1B,CAH+D,CAI8D;;AAE7HmT,IAAAA,mBAAmB,CAACpF,KAAD,EAAQwE,IAAR,CAAnB;AACAuB,IAAAA,gBAAgB,CAACvB,IAAD,EAAOxE,KAAP,EAAcwF,IAAI,IAAI;AACpC,YAAMvF,WAAW,GAAGuF,IAAI,CAACvF,WAAzB;AACA,YAAMrJ,QAAQ,GAAGqJ,WAAW,CAACtH,UAA7B,CAFoC,CAEK;;AAEzC,UAAI,CAAC/B,QAAL,EAAe,OAJqB,CAIb;;AAEvB,UAAIA,QAAQ,CAACgQ,WAAT,IAAwBhQ,QAAQ,CAACiQ,YAAjC,IAAiDjQ,QAAQ,CAAC8O,UAA1D,IAAwE9O,QAAQ,CAAC+O,YAArF,EAAmG;AACjG,cAAMd,EAAE,GAAG9E,MAAM,CAACyF,IAAD,CAAjB;AACA,cAAMsB,WAAW,GAAGhD,OAAO,CAACnF,GAAR,CAAYkG,EAAZ,CAApB;;AAEA,YAAI,CAACiC,WAAL,EAAkB;AAChB;AACAhD,UAAAA,OAAO,CAAC9L,GAAR,CAAY6M,EAAZ,EAAgBW,IAAhB;AACA,cAAI5O,QAAQ,CAACgQ,WAAb,EAA0BhQ,QAAQ,CAACgQ,WAAT,CAAqB,EAAE,GAAGpB,IAAL;AAC7CpM,YAAAA,IAAI,EAAE;AADuC,WAArB;AAG1B,cAAIxC,QAAQ,CAACiQ,YAAb,EAA2BjQ,QAAQ,CAACiQ,YAAT,CAAsB,EAAE,GAAGrB,IAAL;AAC/CpM,YAAAA,IAAI,EAAE;AADyC,WAAtB;AAG5B,SATD,MASO,IAAI0N,WAAW,CAACT,OAAhB,EAAyB;AAC9B;AACAb,UAAAA,IAAI,CAACgB,eAAL;AACD;AACF,OAvBmC,CAuBlC;;;AAGF,UAAI5P,QAAQ,CAACmQ,WAAb,EAA0BnQ,QAAQ,CAACmQ,WAAT,CAAqBvB,IAArB;AAC3B,KA3Be,CAAhB;AA4BA,WAAOhB,IAAP,CAnC+D,CAmClD;AACd,GApCoC,EAoClC,EApCkC,CAArC;AAqCA,QAAMwC,aAAa,GAAG1V,WAAW,CAACW,IAAI,IAAI,CAAC+N,KAAD,EAAQwC,OAAO,GAAG,IAAlB,KAA2B;AACnEtO,IAAAA,KAAK,CAACK,OAAN,CAAcwN,OAAd,CAAsBsD,IAAtB,CAA2BpT,IAA3B,EAAiC+N,KAAjC;AACA,QAAIwC,OAAJ,EAAawB,UAAU,CAAChE,KAAD,CAAV;AACb,UAAMwE,IAAI,GAAGoB,aAAa,CAAC5F,KAAD,CAA1B;AACA+F,IAAAA,gBAAgB,CAACvB,IAAD,EAAOxE,KAAP,EAAcwF,IAAI,IAAI;AACpC,YAAMvF,WAAW,GAAGuF,IAAI,CAACvF,WAAzB;AACA,YAAMrJ,QAAQ,GAAGqJ,WAAW,CAACtH,UAA7B;;AAEA,UAAI/B,QAAQ,IAAIA,QAAQ,CAAC3E,IAAD,CAAxB,EAAgC;AAC9B;AACA;AACA,YAAIA,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,aAA7B,IAA8CA,IAAI,KAAK,aAAvD,IAAwEiC,KAAK,CAACK,OAAN,CAAcuN,WAAd,CAA0B/K,QAA1B,CAAmCkJ,WAAnC,CAA5E,EAA6H;AAC3HrJ,UAAAA,QAAQ,CAAC3E,IAAD,CAAR,CAAeuT,IAAf;AACD;AACF;AACF,KAXe,CAAhB,CAJmE,CAe/D;;AAEJ,QAAIvT,IAAI,KAAK,aAAb,EAA4B;AAC1BiC,MAAAA,KAAK,CAACK,OAAN,CAAcsN,YAAd,GAA6B,CAAC7B,KAAK,CAACkE,WAAN,CAAkBC,OAAnB,EAA4BnE,KAAK,CAACkE,WAAN,CAAkBE,OAA9C,CAA7B;AACAlQ,MAAAA,KAAK,CAACK,OAAN,CAAcuN,WAAd,GAA4B0C,IAAI,CAACyC,GAAL,CAASnB,GAAG,IAAIA,GAAG,CAAC7F,WAApB,CAA5B;AACD;;AAED,QAAI,CAAChO,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,aAA7B,IAA8CA,IAAI,KAAK,aAAxD,KAA0E,CAACuS,IAAI,CAAChR,MAAhF,IAA0FqN,eAA9F,EAA+G;AAC7G,UAAIkE,iBAAiB,CAAC/E,KAAD,CAAjB,IAA4B,CAAhC,EAAmCa,eAAe;AACnD;AACF,GAzBgC,EAyB9B,CAACA,eAAD,EAAkBkE,iBAAlB,EAAqCa,aAArC,EAAoDG,gBAApD,EAAsE/B,UAAtE,CAzB8B,CAAjC;AA0BAzS,EAAAA,OAAO,CAAC,MAAM;AACZ2C,IAAAA,KAAK,CAACK,OAAN,CAAc0N,MAAd,GAAuB;AACrBiF,MAAAA,OAAO,EAAEF,aAAa,CAAC,OAAD,CADD;AAErBG,MAAAA,aAAa,EAAEH,aAAa,CAAC,aAAD,CAFP;AAGrBI,MAAAA,aAAa,EAAEJ,aAAa,CAAC,aAAD,CAHP;AAIrBK,MAAAA,OAAO,EAAEL,aAAa,CAAC,OAAD,CAJD;AAKrBM,MAAAA,aAAa,EAAEN,aAAa,CAAC,aAAD,CALP;AAMrBO,MAAAA,WAAW,EAAEP,aAAa,CAAC,WAAD,CANL;AAOrBQ,MAAAA,cAAc,EAAEC,CAAC,IAAIrC,mBAAmB,CAACqC,CAAD,EAAI,EAAJ,CAPnB;AAQrBC,MAAAA,aAAa,EAAEjF,iBARM;AASrB;AACA;AACA;AACAkF,MAAAA,yBAAyB,EAAEF,CAAC,IAAIvT,KAAK,CAACK,OAAN,CAAcyN,QAAd,GAAyBO,SAAS,CAACkF,CAAD,CAZ7C;AAarBG,MAAAA,oBAAoB,EAAEH,CAAC,KAAKvT,KAAK,CAACK,OAAN,CAAcyN,QAAd,GAAyB3K,SAAzB,EAAoC+N,mBAAmB,CAACqC,CAAD,CAA5D;AAbF,KAAvB;AAeD,GAhBM,EAgBJ,CAACT,aAAD,EAAgBzE,SAAhB,EAA2B6C,mBAA3B,EAAgD3C,iBAAhD,CAhBI,CAAP;AAiBA;AACA;;AAEA,QAAMqC,WAAW,GAAGzT,MAAM,EAA1B;AACAE,EAAAA,OAAO,CAAC,MAAM;AACZ,UAAM;AACJqE,MAAAA,KADI;AAEJZ,MAAAA,MAFI;AAGJe,MAAAA,EAHI;AAIJ4K,MAAAA,QAJI;AAKJ5L,MAAAA,mBALI;AAMJH,MAAAA,MANI;AAOJF,MAAAA,WAPI;AAQJsN,MAAAA,QARI;AASJH,MAAAA,YATI;AAUJC,MAAAA,WAVI;AAWJ,SAAGxI;AAXC,QAYFpF,KAAK,CAACK,OAZV;AAaAuQ,IAAAA,WAAW,CAACvQ,OAAZ,GAAsB+E,KAAtB;AACD,GAfM,EAeJ,CAACiH,IAAD,EAAOc,UAAP,CAfI,CAAP,CAnbyB,CAkcD;;AAExB7P,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAIgP,UAAJ,EAAgB;AACd,UAAIzN,KAAK,CAACC,OAAN,CAAcwN,UAAd,CAAJ,EAA+BvL,EAAE,CAAC4S,aAAH,CAAiBhT,IAAI,CAACC,GAAL,CAASD,IAAI,CAACiT,GAAL,CAAStH,UAAU,CAAC,CAAD,CAAnB,EAAwBuH,MAAM,CAACC,gBAA/B,CAAT,EAA2DxH,UAAU,CAAC,CAAD,CAArE,CAAjB,EAA/B,KAAgIvL,EAAE,CAAC4S,aAAH,CAAiBrH,UAAjB;AACjI;AACF,GAJc,EAIZ,CAACvL,EAAD,EAAKuL,UAAL,CAJY,CAAf,CApcyB,CAwcH;;AAEtBhP,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAIiP,SAAJ,EAAe;AACbxL,MAAAA,EAAE,CAACwL,SAAH,CAAawH,OAAb,GAAuB,IAAvB;AACA,UAAI,OAAOxH,SAAP,KAAqB,QAAzB,EAAmChO,MAAM,CAAC6Q,MAAP,CAAcrO,EAAE,CAACwL,SAAjB,EAA4BA,SAA5B,EAAnC,KAA+ExL,EAAE,CAACwL,SAAH,CAAarH,IAAb,GAAoB1I,gBAApB;AAChF;;AAED,QAAI0H,eAAJ,EAAqB;AACnBnD,MAAAA,EAAE,CAACiT,WAAH,GAAiBvX,qBAAjB;AACAsE,MAAAA,EAAE,CAACkT,cAAH,GAAoBjY,YAApB;AACD;AACF,GAVc,EAUZ,CAACuQ,SAAD,EAAYrI,eAAZ,CAVY,CAAf,CA1cyB,CAodS;AAClC;;AAEA,QAAMgQ,MAAM,GAAG9W,WAAW,CAAC,SAAS8W,MAAT,CAAgB9O,KAAhB,EAAuB;AAChD,UAAM+O,QAAQ,GAAG,MAAMvH,QAAQ,CAAC,IAAD,CAA/B,CADgD,CACT;;;AAGvCrP,IAAAA,SAAS,CAAC,MAAM;AACd,YAAM6W,MAAM,GAAG1H,SAAS,IAAIA,SAAS,CAAC1M,KAAK,CAACK,OAAP,CAArC;AACA,aAAO,MAAM+T,MAAM,IAAIA,MAAM,CAACC,IAAjB,GAAwBD,MAAM,CAACC,IAAP,CAAYF,QAAZ,CAAxB,GAAgDA,QAAQ,EAA9D,CAAP;AACD,KAHQ,EAGN,EAHM,CAAT;AAIA,WAAO/O,KAAK,CAAC2B,QAAb;AACD,GATyB,EASvB,EATuB,CAA1B,CAvdyB,CAgejB;;AAERzJ,EAAAA,eAAe,CAAC,MAAM;AACpB0D,IAAAA,MAAM,EAAE,aAAahE,KAAK,CAACsX,aAAN,CAAoBJ,MAApB,EAA4B,IAA5B,EAAkC,aAAalX,KAAK,CAACsX,aAAN,CAAoBrI,YAAY,CAACsI,QAAjC,EAA2C;AAC7GhR,MAAAA,KAAK,EAAEqN,WAAW,CAACvQ;AAD0F,KAA3C,EAEjE,OAAO0G,QAAP,KAAoB,UAApB,GAAiCA,QAAQ,CAAC/G,KAAK,CAACK,OAAP,CAAzC,GAA2D0G,QAFM,CAA/C,CAAf,EAEoEmG,YAFpE,EAEkFlN,KAFlF,CAAN;AAGD,GAJc,EAIZ,CAAC0B,KAAD,EAAQqF,QAAR,EAAkB6J,WAAW,CAACvQ,OAA9B,CAJY,CAAf;AAKA/C,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAIoE,KAAJ,EAAW;AACT;AACA,UAAI,CAAC1B,KAAK,CAACK,OAAN,CAAcwB,EAAnB,EAAuB;AACrBD,QAAAA,UAAU,CAAC5B,KAAD,CAAV;AACD,OAFD,MAEO,IAAI,CAACe,EAAE,CAACyT,EAAH,IAASzT,EAAE,CAACc,EAAb,KAAoBd,EAAE,CAAC0T,gBAA3B,EAA6C;AAClD,SAAC1T,EAAE,CAACyT,EAAH,IAASzT,EAAE,CAACc,EAAb,EAAiBkS,OAAjB,GAA2B,IAA3B;AACAhT,QAAAA,EAAE,CAAC0T,gBAAH,CAAoBC,CAAC,IAAI3U,QAAQ,CAACC,KAAD,EAAQ0U,CAAR,EAAW,CAAX,EAAc,IAAd,CAAjC;AACD,OAHM,MAGA;AACLC,QAAAA,OAAO,CAACC,IAAR,CAAa,sCAAb;AACD;AACF;AACF,GAZc,EAYZ,CAAClT,KAAD,EAAQb,mBAAR,CAZY,CAAf,CAveyB,CAmfS;;AAElCtD,EAAAA,SAAS,CAAC,MAAM,MAAM;AACpB,QAAIyC,KAAK,CAACK,OAAN,CAAcU,EAAlB,EAAsB;AACpBf,MAAAA,KAAK,CAACK,OAAN,CAAcU,EAAd,CAAiB8T,WAAjB,CAA6BpP,OAA7B;AACA,UAAIzF,KAAK,CAACK,OAAN,CAAcU,EAAd,CAAiB+T,gBAArB,EAAuC9U,KAAK,CAACK,OAAN,CAAcU,EAAd,CAAiB+T,gBAAjB;AACvCrP,MAAAA,OAAO,CAACzF,KAAK,CAACK,OAAN,CAAcU,EAAf,CAAP;AACD;;AAEDgK,IAAAA,sBAAsB,CAAC/K,KAAK,CAACK,OAAN,CAAcY,KAAf,EAAsB,MAAM;AAChDwE,MAAAA,OAAO,CAACzF,KAAK,CAACK,OAAN,CAAc+L,SAAf,CAAP;AACA3G,MAAAA,OAAO,CAACzF,KAAK,CAACK,OAAN,CAAca,MAAf,CAAP;AACAuE,MAAAA,OAAO,CAACzF,KAAK,CAACK,OAAP,CAAP;AACD,KAJqB,CAAtB;AAKD,GAZQ,EAYN,EAZM,CAAT;AAaA,SAAOL,KAAK,CAACK,OAAN,CAAc0N,MAArB;AACD,CAngBD;;AAqgBA,SAAStI,OAAT,CAAiBpH,GAAjB,EAAsB;AACpB,MAAIA,GAAG,CAACoH,OAAR,EAAiBpH,GAAG,CAACoH,OAAJ;;AAEjB,OAAK,MAAMsP,CAAX,IAAgB1W,GAAhB,EAAqB;AACnB,QAAI,OAAO0W,CAAP,KAAa,QAAb,IAAyBA,CAAC,CAACtP,OAA/B,EAAwCsP,CAAC,CAACtP,OAAF;AACxC,WAAOpH,GAAG,CAAC0W,CAAD,CAAV;AACD;AACF;;AAED,SAASvX,UAAT,CAAoBwX,OAApB,EAA6B;AAC3B,MAAIZ,MAAM,GAAG3W,YAAY,CAACuX,OAAD,CAAzB;;AAEA,MAAI,CAACZ,MAAL,EAAa;AACXO,IAAAA,OAAO,CAACC,IAAR,CAAa,mGAAb;AACD;;AAED,SAAOR,MAAP;AACD;;AAED,SAASa,QAAT,CAAkB9V,QAAlB,EAA4B+V,cAAc,GAAG,CAA7C,EAAgD;AAC9C,QAAM;AACJlH,IAAAA;AADI,MAEFxQ,UAAU,CAACyO,YAAD,CAFd,CAD8C,CAGhB;;AAE9B,QAAMxL,GAAG,GAAGtD,MAAM,CAACgC,QAAD,CAAlB;AACA7B,EAAAA,eAAe,CAAC,MAAM,MAAMmD,GAAG,CAACJ,OAAJ,GAAclB,QAApB,CAAP,EAAsC,CAACA,QAAD,CAAtC,CAAf,CAN8C,CAMoB;;AAElE5B,EAAAA,SAAS,CAAC,MAAM;AACd,UAAM4X,WAAW,GAAGnH,SAAS,CAACvN,GAAD,EAAMyU,cAAN,CAA7B;AACA,WAAO,MAAMC,WAAW,EAAxB;AACD,GAHQ,EAGN,CAACD,cAAD,EAAiBlH,SAAjB,CAHM,CAAT;AAIA,SAAO,IAAP;AACD;;AACD,SAASoH,QAAT,GAAoB;AAClB,SAAO5X,UAAU,CAACyO,YAAD,CAAjB;AACD;;AACD,SAASoJ,SAAT,CAAmBlW,QAAnB,EAA6BmW,UAA7B,EAAyCC,WAAzC,EAAsD;AACpD,QAAM;AACJ3T,IAAAA;AADI,MAEFpE,UAAU,CAACyO,YAAD,CAFd;AAGA,QAAMuJ,QAAQ,GAAGrY,MAAM,EAAvB;AACA,QAAMsD,GAAG,GAAG8U,WAAW,GAAGA,WAAH,GAAiBC,QAAxC;AACAlY,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAImD,GAAG,CAACJ,OAAR,EAAiB;AACflB,MAAAA,QAAQ,CAACsB,GAAG,CAACJ,OAAL,CAAR;AACAuB,MAAAA,UAAU;AACX;AACF,GALc,EAKZ0T,UALY,CAAf,CANoD,CAWpC;;AAEhB,SAAO7U,GAAP;AACD;;AACD,SAASgV,WAAT,CAAqBF,WAArB,EAAkC;AAChC,QAAM,CAACG,CAAD,EAAIC,WAAJ,IAAmBzY,QAAQ,CAAC,KAAD,CAAjC;AACA,QAAMsY,QAAQ,GAAGrY,MAAM,CAACgG,SAAD,CAAvB;AACA,QAAM1C,GAAG,GAAG8U,WAAW,GAAGA,WAAH,GAAiBC,QAAxC;AACAlY,EAAAA,eAAe,CAAC,MAAM,KAAKqY,WAAW,CAAC1W,CAAC,IAAI,CAACA,CAAP,CAAvB,EAAkC,EAAlC,CAAf;AACA,SAAOwB,GAAP;AACD;;AAED,SAASmV,SAAT,CAAmBC,UAAnB,EAA+BC,UAA/B,EAA2C;AACzC,SAAO,UAAUC,KAAV,EAAiBC,GAAjB,EAAsB;AAC3B;AACA,UAAMC,MAAM,GAAG,IAAIF,KAAJ,EAAf;AACA,QAAIF,UAAJ,EAAgBA,UAAU,CAACI,MAAD,CAAV,CAHW,CAGS;;AAEpC,UAAMC,QAAQ,GAAGrX,KAAK,CAACC,OAAN,CAAckX,GAAd,IAAqBA,GAArB,GAA2B,CAACA,GAAD,CAA5C;AACA,WAAOG,OAAO,CAACC,GAAR,CAAYF,QAAQ,CAACnD,GAAT,CAAaiD,GAAG,IAAI,IAAIG,OAAJ,CAAY,CAACE,GAAD,EAAMC,MAAN,KAAiBL,MAAM,CAACM,IAAP,CAAYP,GAAZ,EAAiB1E,IAAI,IAAI;AAC3F,UAAIA,IAAI,CAACrQ,KAAT,EAAgB;AACdqQ,QAAAA,IAAI,CAACkF,KAAL,GAAa,EAAb;AACAlF,QAAAA,IAAI,CAACmF,SAAL,GAAiB,EAAjB;AACAnF,QAAAA,IAAI,CAACrQ,KAAL,CAAWyV,QAAX,CAAoBrY,GAAG,IAAI;AACzB,cAAIA,GAAG,CAACN,IAAR,EAAcuT,IAAI,CAACkF,KAAL,CAAWnY,GAAG,CAACN,IAAf,IAAuBM,GAAvB;AACd,cAAIA,GAAG,CAACsY,QAAJ,IAAgB,CAACrF,IAAI,CAACmF,SAAL,CAAepY,GAAG,CAACsY,QAAJ,CAAa5Y,IAA5B,CAArB,EAAwDuT,IAAI,CAACmF,SAAL,CAAepY,GAAG,CAACsY,QAAJ,CAAa5Y,IAA5B,IAAoCM,GAAG,CAACsY,QAAxC;AACzD,SAHD;AAID;;AAEDN,MAAAA,GAAG,CAAC/E,IAAD,CAAH;AACD,KAXmE,EAWjEwE,UAXiE,EAWrDc,KAAK,IAAIN,MAAM,CAACM,KAAK,CAACC,OAAP,CAXsC,CAA7B,CAApB,CAAZ,CAAP;AAYD,GAlBD;AAmBD;;AAED,SAASC,SAAT,CAAmBf,KAAnB,EAA0BC,GAA1B,EAA+BH,UAA/B,EAA2CC,UAA3C,EAAuD;AACrD;AACA,QAAMiB,OAAO,GAAGpZ,QAAQ,CAACiY,SAAS,CAACC,UAAD,EAAaC,UAAb,CAAV,EAAoC,CAACC,KAAD,EAAQC,GAAR,CAApC,CAAxB,CAFqD,CAEsB;;AAE3E,SAAOnX,KAAK,CAACC,OAAN,CAAckX,GAAd,IAAqBe,OAArB,GAA+BA,OAAO,CAAC,CAAD,CAA7C;AACD;;AAEDD,SAAS,CAACE,OAAV,GAAoB,UAAUjB,KAAV,EAAiBC,GAAjB,EAAsBH,UAAtB,EAAkC;AACpD,SAAOlY,QAAQ,CAACqZ,OAAT,CAAiBpB,SAAS,CAACC,UAAD,CAA1B,EAAwCE,KAAxC,EAA+CC,GAA/C,CAAP;AACD,CAFD;;AAIA,MAAMiB,aAAa,GAAG;AACpB3J,EAAAA,QAAQ,EAAE,UADU;AAEpBmB,EAAAA,KAAK,EAAE,MAFa;AAGpBC,EAAAA,MAAM,EAAE,MAHY;AAIpBwI,EAAAA,QAAQ,EAAE;AAJU,CAAtB;;AAOA,SAASC,OAAT,CAAiB;AACfpQ,EAAAA,QADe;AAEfqQ,EAAAA,SAFe;AAGf7U,EAAAA,SAHe;AAIf8U,EAAAA,QAJe;AAKfC,EAAAA,OALe;AAMf,KAAGlS;AANY,CAAjB,EAOG;AACD;AACA,QAAM,CAACrE,EAAD,IAAO7D,QAAQ,CAACma,QAAD,CAArB;AACA,MAAI,CAACtW,EAAL,EAAS4T,OAAO,CAACC,IAAR,CAAa,sBAAb,EAHR,CAG8C;;AAE/CrX,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI+Z,OAAJ,EAAaA,OAAO,CAACvW,EAAD,EAAKwB,SAAL,CAAP;AACd,GAFQ,EAEN,CAACA,SAAD,EAAY+U,OAAZ,EAAqBvW,EAArB,CAFM,CAAT,CALC,CAO6B;;AAE9B,QAAMgN,MAAM,GAAG7B,SAAS,CAAC,EAAE,GAAG9G,KAAL;AACvB2B,IAAAA,QADuB;AAEvBhG,IAAAA,EAAE,EAAEA;AAFmB,GAAD,CAAxB;AAIAxD,EAAAA,SAAS,CAAC,MAAM;AACd6Z,IAAAA,SAAS,CAACrJ,MAAD,CAAT;AACD,GAFQ,EAEN,CAACA,MAAD,EAASqJ,SAAT,CAFM,CAAT;AAGA,SAAO,IAAP;AACD;;AAED,MAAMG,eAAe,GAAG,aAAava,KAAK,CAACwa,IAAN,CAAW,SAASD,eAAT,CAAyBnS,KAAzB,EAAgC;AAC9E,QAAM;AACJiS,IAAAA,QADI;AAEJC,IAAAA,OAFI;AAGJvQ,IAAAA,QAHI;AAIJlF,IAAAA,EAJI;AAKJ4V,IAAAA,MALI;AAMJ7M,IAAAA,UANI;AAOJ2B,IAAAA,SAPI;AAQJrI,IAAAA,eARI;AASJiI,IAAAA,YATI;AAUJtL,IAAAA,mBAVI;AAWJ2L,IAAAA,mBAXI;AAYJC,IAAAA,QAZI;AAaJ1L,IAAAA,EAbI;AAcJG,IAAAA,MAdI;AAeJkL,IAAAA,SAfI;AAgBJE,IAAAA,UAhBI;AAiBJI,IAAAA,SAjBI;AAkBJC,IAAAA,eAlBI;AAmBJ+K,IAAAA,SAnBI;AAoBJC,IAAAA,MApBI;AAqBJC,IAAAA,KArBI;AAsBJ,OAAGC;AAtBC,MAuBFzS,KAvBJ;AAwBA,QAAM0S,YAAY,GAAG3a,MAAM,EAA3B,CAzB8E,CAyB/C;;AAE/B,QAAM,CAAC;AACLsW,IAAAA,yBADK;AAEL,OAAG1F;AAFE,GAAD,EAGHqJ,SAHG,IAGUla,QAAQ,CAAC,EAAD,CAHxB;AAIA,QAAM,CAAC6a,IAAD,EAAO1L,IAAP,EAAavK,WAAb,IAA4BlE,UAAU,CAAC+Z,MAAM,IAAI;AACrDK,IAAAA,MAAM,EAAE,IAD6C;AAErDC,IAAAA,QAAQ,EAAE;AACRD,MAAAA,MAAM,EAAE,EADA;AAERL,MAAAA,MAAM,EAAE;AAFA,KAF2C;AAMrDO,IAAAA,QAAQ,EAAE,OAAOrE,MAAP,KAAkB,WAAlB,IAAiC,CAACA,MAAM,CAAChW,cAAzC,GAA0DA,cAA1D,GAA2EsF;AANhC,GAAX,CAA5C,CA/B8E,CAsC1E;;AAEJ,QAAMgV,SAAS,GAAGhb,MAAM,CAAC,KAAD,CAAxB;AACA,QAAMuE,KAAK,GAAGrE,OAAO,CAAC,MAAM8a,SAAS,CAAC9X,OAAV,GAAoB8X,SAAS,CAAC9X,OAAV,IAAqB,CAAC,CAACgM,IAAI,CAACoC,KAAP,IAAgB,CAAC,CAACpC,IAAI,CAACqC,MAAvE,EAA+E,CAACrC,IAAD,CAA/E,CAArB;AACA,QAAMrM,KAAK,GAAG3C,OAAO,CAAC,OAAO;AAC3BgP,IAAAA,IAD2B;AAE3BvK,IAAAA,WAF2B;AAG3BsV,IAAAA,SAH2B;AAI3B7U,IAAAA,SAAS,EAAEuV,YAAY,CAACzX;AAJG,GAAP,CAAD,EAKjB,CAACyB,WAAD,EAAcuK,IAAd,CALiB,CAArB,CA1C8E,CA+CpD;;AAE1B,MAAI,OAAOwH,MAAP,KAAkB,WAAtB,EAAmC,OAAO,aAAa7W,KAAK,CAACsX,aAAN,CAAoB,KAApB,EAA2B3Y,QAAQ,CAAC;AACzFic,IAAAA,KAAK,EAAE,EAAE,GAAGX,aAAL;AACL,SAAGW;AADE;AADkF,GAAD,EAIvFC,UAJuF,CAAnC,EAIvCH,SAJuC,CAApB,CAjD2C,CAqDlD;;AAE5B,SAAO,aAAa1a,KAAK,CAACsX,aAAN,CAAoB,KAApB,EAA2B3Y,QAAQ,CAAC;AACtD8E,IAAAA,GAAG,EAAE3C,SAAS,CAAC,CAACia,IAAD,EAAOD,YAAP,CAAD,CADwC;AAEtDF,IAAAA,KAAK,EAAE,EAAE,GAAGX,aAAL;AACL,SAAGW;AADE;AAF+C,GAAD,EAKpD7J,MALoD,EAK5C8J,UAL4C,CAAnC,EAKIH,SALJ,EAKehW,KAAK,IAAI,aAAa1E,KAAK,CAACsX,aAAN,CAAoB6C,OAApB,EAA6Bxb,QAAQ,CAAC,EAAD,EAAKyJ,KAAL,EAAYpF,KAAZ,CAArC,CALrC,CAApB;AAMD,CA7DoC,CAArC;AA+DA,MAAMkU,MAAM,GAAG,aAAalX,KAAK,CAACwa,IAAN,CAAW,SAAStD,MAAT,CAAgB;AACrDnN,EAAAA,QADqD;AAErD,KAAG3B;AAFkD,CAAhB,EAGpC;AACD,QAAMgT,SAAS,GAAGjb,MAAM,EAAxB;AACA,QAAMka,QAAQ,GAAGjS,KAAK,CAACqS,MAAN,GAAe/a,cAAf,GAAgCC,aAAjD;AACA,SAAO,aAAaK,KAAK,CAACsX,aAAN,CAAoBiD,eAApB,EAAqC5b,QAAQ,CAAC,EAAD,EAAKyJ,KAAL,EAAY;AAC3EiS,IAAAA,QAAQ,EAAE,MAAM;AACd,UAAIe,SAAS,CAAC/X,OAAd,EAAuB;AACrB,cAAMgY,MAAM,GAAG;AACbC,UAAAA,SAAS,EAAE,IADE;AAEbC,UAAAA,KAAK,EAAE,IAFM;AAGb,aAAGnT,KAAK,CAACrE;AAHI,SAAf;AAKA,cAAM8O,IAAI,GAAG,IAAIwH,QAAJ,CAAa;AACxBmB,UAAAA,eAAe,EAAE,kBADO;AAExB;AACA;AACAC,UAAAA,MAAM,EAAEL,SAAS,CAAC/X,OAJM;AAKxB,aAAGgY;AALqB,SAAb,CAAb;AAOA,eAAOxI,IAAP;AACD;AACF,KAjB0E;AAkB3E6H,IAAAA,SAAS,EAAE,aAAa1a,KAAK,CAACsX,aAAN,CAAoB,QAApB,EAA8B;AACpD7T,MAAAA,GAAG,EAAE2X,SAD+C;AAEpDR,MAAAA,KAAK,EAAE;AACLc,QAAAA,OAAO,EAAE;AADJ;AAF6C,KAA9B;AAlBmD,GAAZ,CAA7C,EAwBhB3R,QAxBgB,CAApB;AAyBD,CA/B2B,CAA5B;AAiCA,SAASmN,MAAT,EAAiBtM,QAAjB,EAA2B/H,cAA3B,EAA2CD,SAA3C,EAAsDE,OAAtD,EAA+DoC,UAA/D,EAA2E+I,YAA3E,EAAyFjJ,MAAzF,EAAiGF,WAAjG,EAA8GF,UAA9G,EAA0H+J,oBAA1H,EAAgJ3K,MAAhJ,EAAwJjB,QAAxJ,EAAkKkM,YAAlK,EAAgLlB,sBAAhL,EAAwMmB,SAAxM,EAAmN+I,QAAnN,EAA6N6B,SAA7N,EAAwOrB,WAAxO,EAAqPL,QAArP,EAA+PC,SAA/P","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGL1Renderer, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React, { createContext, useState, useRef, useCallback, useMemo, useLayoutEffect, useEffect, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\n\nvar name = \"react-three-fiber\";\nvar version = \"5.1.5\";\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  let i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  const delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0;\n  let i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) {\n    roots.forEach(root => root.containerInfo.__state.current.frames = frames);\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nfunction forceResize() {\n  roots.forEach(root => root.containerInfo.__state.current.forceResize());\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = { ...catalogue,\n  ...objects\n});\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = [];\n  const handlers = [];\n  let i;\n  let keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  const leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  const toFilter = [...sameProps, 'children', 'key', 'ref']; // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n  const filteredProps = { ...newProps\n  }; // Removes sameProps and reserved props from newProps\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  const filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        const isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            target.set(...value);\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n              target.copy(value);\n            } // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, {\n  args = [],\n  ...props\n}, container, hostContext, internalInstanceHandle) {\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = {\n      dispose: null,\n      ...props\n    };\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    const target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/react-spring/react-three-fiber/blob/master/api.md#putting-already-existing-objects-into-the-scene-graph\";\n    }\n\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = {\n      attach: 'geometry',\n      ...props\n    };\n  } else if (name.endsWith('Material')) {\n    props = {\n      attach: 'material',\n      ...props\n    };\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove interactivity\n        if (child.__container) {\n          child.__container.__interaction = child.__container.__interaction.filter(x => x !== child);\n        } // Remove nested child objects\n\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = [],\n        ...restNew\n      } = newProps;\n      const {\n        args: argsOld = [],\n        ...restOld\n      } = oldProps; // If it has new props or arguments, then it needs to be re-instanciated\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {\n    return null;\n  },\n\n  preparePortalMount() {\n    return null;\n  },\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  },\n\n  clearContainer() {\n    return false;\n  }\n\n});\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    let newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container, callback) {\n  const root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, () => {\n      roots.delete(container);\n      if (callback) callback(container);\n    });\n  }\n}\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: () => null,\n  version: version,\n  rendererPackageName: name\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = /*#__PURE__*/createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    colorManagement = true,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed,\n    forceResize\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const {\n        filter,\n        computeOffsets,\n        ...raycasterProps\n      } = raycaster;\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        var _state$current;\n\n        if ((_state$current = state.current) == null ? void 0 : _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n        }\n      };\n    },\n    setDefaultCamera: camera => setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: (event = {}, prepare = true) => handlePointerMove(event, prepare),\n    forceResize\n  });\n  const getCurrentViewport = useCallback((camera = state.current.camera, target = new Vector3(0, 0, 0)) => {\n    const {\n      width,\n      height\n    } = state.current.size;\n    const distance = camera.position.distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance\n      };\n    } else {\n      const fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, gl, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  const hovered = useMemo(() => new Map(), []);\n  const temp = new Vector3();\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    const offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event)) || event.nativeEvent;\n\n    if (offsets) {\n      const {\n        offsetX,\n        offsetY\n      } = offsets;\n      const {\n        width,\n        height\n      } = state.current.size;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (const intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push({ ...intersect,\n          eventObject\n        });\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    const dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    const dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const handlePointerCancel = useCallback((event, hits, prepare = true) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event); // commenting this out as I believe it is unneccessary and causes a recursive dependency\n    // if (!hits) hits = handleIntersects(event, () => null)\n\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n        hovered.delete(makeId(data));\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut({ ...data,\n            type: 'pointerout'\n          });\n          if (handlers.pointerLeave) handlers.pointerLeave({ ...data,\n            type: 'pointerleave'\n          });\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  const getIntersects = useCallback((event, filter) => {\n    // Get fresh intersects\n    const intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!intersections.find(hit => hit.eventObject === captured.eventObject)) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((intersections, event, fn) => {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (const hit of intersections) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) {\n            state.current.captured.push(hit);\n          } // Call the original event now\n          event.target.setPointerCapture(id);\n        };\n\n        const raycastEvent = { ...event,\n          ...hit,\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/react-spring/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const cap = state.current.captured;\n\n            if (!cap || cap.find(h => h.eventObject.id === hit.eventObject.id)) {\n              raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n\n              if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) handlePointerCancel(raycastEvent, [hit]);\n            }\n          },\n          target: { ...event.target,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          currentTarget: { ...event.currentTarget,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          sourceEvent: event\n        };\n        fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n        if (localState.stopped === true) break;\n      }\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  const handlePointerMove = useCallback((event, prepare = true) => {\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver({ ...data,\n            type: 'pointerover'\n          });\n          if (handlers.pointerEnter) handlers.pointerEnter({ ...data,\n            type: 'pointerenter'\n          });\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const handlePointer = useCallback(name => (event, prepare = true) => {\n    state.current.pointer.emit(name, event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click events,\n        // which must use the initial target\n        if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n          handlers[name](data);\n        }\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const {\n      ready,\n      manual,\n      vr,\n      noEvents,\n      invalidateFrameloop,\n      frames,\n      subscribers,\n      captured,\n      initialClick,\n      initialHits,\n      ...props\n    } = state.current;\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, colorManagement]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/React.createElement(Canvas, null, /*#__PURE__*/React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      state.current.gl.renderLists.dispose();\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      dispose(state.current.gl);\n    }\n\n    unmountComponentAtNode(state.current.scene, () => {\n      dispose(state.current.raycaster);\n      dispose(state.current.camera);\n      dispose(state.current);\n    });\n  }, []);\n  return state.current.events;\n};\n\nfunction dispose(obj) {\n  if (obj.dispose) obj.dispose();\n\n  for (const p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority, subscribe]);\n  return null;\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), []);\n  return ref;\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, url) {\n    // Construct new loader and run extensions\n    const loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise((res, reject) => loader.load(url, data => {\n      if (data.scene) {\n        data.nodes = {};\n        data.materials = {};\n        data.scene.traverse(obj => {\n          if (obj.name) data.nodes[obj.name] = obj;\n          if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n        });\n      }\n\n      res(data);\n    }, onProgress, error => reject(error.message)))));\n  };\n}\n\nfunction useLoader(Proto, url, extensions, onProgress) {\n  // Use suspense to load async assets\n  const results = useAsset(loadingFn(extensions, onProgress), [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, url, extensions) {\n  return useAsset.preload(loadingFn(extensions), Proto, url);\n};\n\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content({\n  children,\n  setEvents,\n  container,\n  renderer,\n  effects,\n  ...props\n}) {\n  // Create renderer\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  useEffect(() => {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas({ ...props,\n    children,\n    gl: gl\n  });\n  useEffect(() => {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nconst ResizeContainer = /*#__PURE__*/React.memo(function ResizeContainer(props) {\n  const {\n    renderer,\n    effects,\n    children,\n    vr,\n    webgl1,\n    concurrent,\n    shadowMap,\n    colorManagement,\n    orthographic,\n    invalidateFrameloop,\n    updateDefaultCamera,\n    noEvents,\n    gl,\n    camera,\n    raycaster,\n    pixelRatio,\n    onCreated,\n    onPointerMissed,\n    preRender,\n    resize,\n    style,\n    ...restSpread\n  } = props;\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [{\n    onGotPointerCaptureLegacy,\n    ...events\n  }, setEvents] = useState({});\n  const [bind, size, forceResize] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    forceResize,\n    setEvents,\n    container: containerRef.current\n  }), [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React.createElement(\"div\", _extends({\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React.createElement(Content, _extends({}, props, state)));\n});\n\nconst Canvas = /*#__PURE__*/React.memo(function Canvas({\n  children,\n  ...props\n}) {\n  const canvasRef = useRef();\n  const renderer = props.webgl1 ? WebGL1Renderer : WebGLRenderer;\n  return /*#__PURE__*/React.createElement(ResizeContainer, _extends({}, props, {\n    renderer: () => {\n      if (canvasRef.current) {\n        const params = {\n          antialias: true,\n          alpha: true,\n          ...props.gl\n        };\n        const temp = new renderer({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current,\n          ...params\n        });\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nexport { Canvas, Renderer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, forceResize, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}